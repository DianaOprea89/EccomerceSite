{"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"filename\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\src\\\\server.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"transform-runtime\",\"visitor\":{\"MemberExpression\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"Identifier\":{\"enter\":[null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"regenerator\":true},\"externalDependencies\":[]},{\"key\":\"transform-unicode-sets-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-class-static-block\",\"visitor\":{\"ClassBody\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-private-property-in-object\",\"visitor\":{\"BinaryExpression\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-private-methods\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-numeric-separator\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"BigIntLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-logical-assignment-operators\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-nullish-coalescing-operator\",\"visitor\":{\"LogicalExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-chaining\",\"visitor\":{\"OptionalCallExpression\":{\"enter\":[null]},\"OptionalMemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-json-strings\",\"visitor\":{\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-catch-binding\",\"visitor\":{\"CatchClause\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-parameters\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-generator-functions\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-to-generator\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-exponentiation-operator\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-template-literals\",\"visitor\":{\"TaggedTemplateExpression\":{\"enter\":[null]},\"TemplateLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-literals\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-function-name\",\"visitor\":{\"FunctionExpression\":{\"exit\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-arrow-functions\",\"visitor\":{\"ArrowFunctionExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoped-functions\",\"visitor\":{\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-classes\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-super\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-shorthand-properties\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-duplicate-keys\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-computed-properties\",\"visitor\":{\"ObjectExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-for-of\",\"visitor\":{\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-sticky-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-escapes\",\"visitor\":{\"Identifier\":{\"enter\":[null]},\"TemplateElement\":{\"enter\":[null]},\"_exploded\":true,\"StringLiteral\":{\"enter\":[null]},\"DirectiveLiteral\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-spread\",\"visitor\":{\"ArrayExpression\":{\"enter\":[null]},\"CallExpression\":{\"enter\":[null]},\"NewExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-destructuring\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"VariableDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoping\",\"visitor\":{\"VariableDeclaration\":{\"enter\":[null,null]},\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-typeof-symbol\",\"visitor\":{\"UnaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"BlockStatement\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"Program\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"SwitchStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"StaticBlock\":{\"enter\":[null]},\"TSModuleBlock\":{\"enter\":[null]},\"AssignmentPattern\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-new-target\",\"visitor\":{\"MetaProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-regenerator\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassPrivateMethod\":{\"enter\":[null],\"exit\":[null]},\"FunctionDeclaration\":{\"exit\":[null]},\"FunctionExpression\":{\"exit\":[null]},\"ArrowFunctionExpression\":{\"exit\":[null]},\"MemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-member-expression-literals\",\"visitor\":{\"MemberExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-property-literals\",\"visitor\":{\"ObjectProperty\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-reserved-words\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null,null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-export-namespace-from\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dynamic-import\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-import-meta\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.22.9:development":{"value":{"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _express = _interopRequireDefault(require(\"express\"));\nvar _bodyParser = _interopRequireDefault(require(\"body-parser\"));\nvar _mongodb = require(\"mongodb\");\nvar _path = _interopRequireDefault(require(\"path\"));\nvar _bcrypt = _interopRequireDefault(require(\"bcrypt\"));\nvar _cors = _interopRequireDefault(require(\"cors\"));\nvar jwt = require('jsonwebtoken');\nrequire('dotenv').config();\nvar app = (0, _express[\"default\"])();\nvar corsOptions = {\n  origin: 'http://localhost:8080',\n  // Replace with your frontend's URL\n  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n  credentials: true,\n  optionsSuccessStatus: 204\n};\napp.use((0, _cors[\"default\"])(corsOptions));\nvar db; // We'll initialize this once and reuse it\n\n// Connect to MongoDB once and use it across requests\nvar connectionString = process.env.MONGODB_URI || 'mongodb://127.0.0.1:27017';\nconsole.log(\"Connecting to: \".concat(connectionString));\n_mongodb.MongoClient.connect(connectionString, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n}).then(function (client) {\n  db = client.db('vue-db');\n  console.log('Connected to MongoDB');\n\n  // Run the migration script here\n  var usersCollection = db.collection('users');\n  function runMigration() {\n    return _runMigration.apply(this, arguments);\n  }\n  function _runMigration() {\n    _runMigration = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var result;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return usersCollection.updateMany({}, {\n              $set: {\n                name: '',\n                email: '',\n                password: '',\n                passwordConfirm: '',\n                newField: 'default value'\n              }\n            });\n          case 3:\n            result = _context.sent;\n            console.log('Documents updated:', result.modifiedCount);\n            _context.next = 10;\n            break;\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.error('Error updating documents:', _context.t0);\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n    return _runMigration.apply(this, arguments);\n  }\n})[\"catch\"](function (error) {\n  console.error('Failed to connect to MongoDB', error);\n  process.exit(1);\n});\napp.use(_bodyParser[\"default\"].json());\napp.use('/assets', _express[\"default\"][\"static\"](_path[\"default\"].join(__dirname, '../assets')));\napp.post('/api/token/refresh', /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(req, res) {\n    var refreshToken, decodedRefreshToken, newAccessToken;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          refreshToken = req.body.refreshToken; // Getting refreshToken from request body\n          if (refreshToken) {\n            _context2.next = 3;\n            break;\n          }\n          return _context2.abrupt(\"return\", res.status(401).json({\n            message: 'Refresh token is required'\n          }));\n        case 3:\n          try {\n            // Validate the existing refresh token\n            decodedRefreshToken = jwt.verify(refreshToken, 'yourRefreshSecretKeyHere'); // Ideally, replace 'yourRefreshSecretKeyHere' with a secret stored in env variables\n            // If it's valid, generate a new access token\n            newAccessToken = jwt.sign({\n              id: decodedRefreshToken.id\n            }, 'yourSecretKeyHere', {\n              expiresIn: '1h'\n            }); // Ideally, replace 'yourSecretKeyHere' with a secret stored in env variables\n            // Send the new access token back to the client\n            res.status(200).json({\n              accessToken: newAccessToken\n            });\n          } catch (error) {\n            res.status(401).json({\n              message: 'Invalid refresh token'\n            });\n          }\n        case 4:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function (_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}());\napp.get('/api/products', /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(req, res) {\n    var products;\n    return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return db.collection('products').find({}).toArray();\n        case 2:\n          products = _context3.sent;\n          res.status(200).json(products);\n        case 4:\n        case \"end\":\n          return _context3.stop();\n      }\n    }, _callee3);\n  }));\n  return function (_x3, _x4) {\n    return _ref2.apply(this, arguments);\n  };\n}());\napp.get('/api/users/:userId/cart', /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(req, res) {\n    var token, userId, user, products;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          console.log('Fetching cart for userId:', req.params.userId); // Access userId directly\n          token = req.headers.authorization;\n          userId = req.params.userId;\n          _context4.next = 5;\n          return db.collection('users').findOne({\n            id: userId\n          });\n        case 5:\n          user = _context4.sent;\n          if (user) {\n            _context4.next = 8;\n            break;\n          }\n          return _context4.abrupt(\"return\", res.status(404).json('Could not find user!'));\n        case 8:\n          _context4.next = 10;\n          return db.collection('products').find({\n            id: {\n              $in: user.cartItems\n            }\n          }).toArray();\n        case 10:\n          products = _context4.sent;\n          res.status(200).json(products);\n        case 12:\n        case \"end\":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function (_x5, _x6) {\n    return _ref3.apply(this, arguments);\n  };\n}());\napp.get('/api/products/:productId', /*#__PURE__*/function () {\n  var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(req, res) {\n    var productId, product;\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          productId = req.params.productId;\n          _context5.next = 3;\n          return db.collection('products').findOne({\n            id: productId\n          });\n        case 3:\n          product = _context5.sent;\n          if (product) {\n            res.status(200).json(product);\n          } else {\n            res.status(404).json('Could not find the product!');\n          }\n        case 5:\n        case \"end\":\n          return _context5.stop();\n      }\n    }, _callee5);\n  }));\n  return function (_x7, _x8) {\n    return _ref4.apply(this, arguments);\n  };\n}());\napp.post('/api/users/:userId/cart', /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(req, res) {\n    var token, decodedToken, userId, productId, user, products;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          token = req.headers.authorization;\n          _context6.prev = 1;\n          decodedToken = jwt.verify(token, 'yourSecretKeyHere');\n          userId = decodedToken.id;\n          console.log(userId);\n          productId = req.body.productId;\n          _context6.next = 8;\n          return db.collection('users').findOne({\n            id: userId\n          });\n        case 8:\n          user = _context6.sent;\n          if (user) {\n            _context6.next = 11;\n            break;\n          }\n          return _context6.abrupt(\"return\", res.status(404).json('Could not find user!'));\n        case 11:\n          _context6.next = 13;\n          return db.collection('users').updateOne({\n            id: userId\n          }, {\n            $addToSet: {\n              cartItems: productId\n            }\n          });\n        case 13:\n          _context6.next = 15;\n          return db.collection('products').find({\n            id: {\n              $in: user.cartItems\n            }\n          }).toArray();\n        case 15:\n          products = _context6.sent;\n          res.status(200).json(products);\n          _context6.next = 22;\n          break;\n        case 19:\n          _context6.prev = 19;\n          _context6.t0 = _context6[\"catch\"](1);\n          res.status(401).json('Unauthorized');\n        case 22:\n        case \"end\":\n          return _context6.stop();\n      }\n    }, _callee6, null, [[1, 19]]);\n  }));\n  return function (_x9, _x10) {\n    return _ref5.apply(this, arguments);\n  };\n}());\napp[\"delete\"]('/api/users/:userId/cart/:productId', /*#__PURE__*/function () {\n  var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(req, res) {\n    var _req$params, userId, productId, user, products;\n    return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _req$params = req.params, userId = _req$params.userId, productId = _req$params.productId;\n          _context7.next = 3;\n          return db.collection('users').findOne({\n            id: userId\n          });\n        case 3:\n          user = _context7.sent;\n          if (user) {\n            _context7.next = 6;\n            break;\n          }\n          return _context7.abrupt(\"return\", res.status(404).json('Could not find user!'));\n        case 6:\n          _context7.next = 8;\n          return db.collection('users').updateOne({\n            id: userId\n          }, {\n            $pull: {\n              cartItems: productId\n            }\n          });\n        case 8:\n          _context7.next = 10;\n          return db.collection('products').find({\n            id: {\n              $in: user.cartItems\n            }\n          }).toArray();\n        case 10:\n          products = _context7.sent;\n          res.status(200).json(products);\n        case 12:\n        case \"end\":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function (_x11, _x12) {\n    return _ref6.apply(this, arguments);\n  };\n}());\napp.post('/api/register', /*#__PURE__*/function () {\n  var _ref7 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee8(req, res) {\n    var _req$body, id, name, email, password, passwordConfirm, existingUser, hashedPassword, newUser, token;\n    return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n          _req$body = req.body, id = _req$body.id, name = _req$body.name, email = _req$body.email, password = _req$body.password, passwordConfirm = _req$body.passwordConfirm;\n          if (!(!name || !email || !password || !passwordConfirm)) {\n            _context8.next = 4;\n            break;\n          }\n          return _context8.abrupt(\"return\", res.status(400).json({\n            message: 'Please fill all fields'\n          }));\n        case 4:\n          if (!(password !== passwordConfirm)) {\n            _context8.next = 6;\n            break;\n          }\n          return _context8.abrupt(\"return\", res.status(400).json({\n            message: 'Passwords do not match'\n          }));\n        case 6:\n          _context8.next = 8;\n          return db.collection('users').findOne({\n            email: email\n          });\n        case 8:\n          existingUser = _context8.sent;\n          if (!existingUser) {\n            _context8.next = 11;\n            break;\n          }\n          return _context8.abrupt(\"return\", res.status(400).json({\n            message: 'Email is already registered'\n          }));\n        case 11:\n          _context8.next = 13;\n          return _bcrypt[\"default\"].hash(password, 10);\n        case 13:\n          hashedPassword = _context8.sent;\n          // Directly using a number as salt rounds\n          newUser = {\n            id: id,\n            name: name,\n            email: email,\n            password: hashedPassword,\n            cartItems: []\n          }; // Insert the new user into the database\n          _context8.next = 17;\n          return db.collection('users').insertOne(newUser);\n        case 17:\n          // Generate a JWT token for the user\n          token = jwt.sign({\n            id: newUser.id\n          }, process.env.JWT_SECRET, {\n            expiresIn: process.env.JWT_EXPIRES_IN\n          });\n          res.status(201).json({\n            message: 'User registered successfully',\n            token: token,\n            user: {\n              name: name,\n              email: email\n            }\n          });\n          _context8.next = 25;\n          break;\n        case 21:\n          _context8.prev = 21;\n          _context8.t0 = _context8[\"catch\"](0);\n          console.error('Error registering user:', _context8.t0);\n          res.status(500).json({\n            message: 'Server error'\n          });\n        case 25:\n        case \"end\":\n          return _context8.stop();\n      }\n    }, _callee8, null, [[0, 21]]);\n  }));\n  return function (_x13, _x14) {\n    return _ref7.apply(this, arguments);\n  };\n}());\napp.post('/api/login', /*#__PURE__*/function () {\n  var _ref8 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee9(req, res) {\n    var _req$body2, email, password, user, isPasswordValid, token;\n    return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n      while (1) switch (_context9.prev = _context9.next) {\n        case 0:\n          _req$body2 = req.body, email = _req$body2.email, password = _req$body2.password;\n          _context9.next = 3;\n          return db.collection('users').findOne({\n            email: email\n          });\n        case 3:\n          user = _context9.sent;\n          if (user) {\n            _context9.next = 6;\n            break;\n          }\n          return _context9.abrupt(\"return\", res.status(400).json({\n            message: 'Invalid email or password'\n          }));\n        case 6:\n          _context9.next = 8;\n          return _bcrypt[\"default\"].compare(password, user.password);\n        case 8:\n          isPasswordValid = _context9.sent;\n          if (isPasswordValid) {\n            _context9.next = 11;\n            break;\n          }\n          return _context9.abrupt(\"return\", res.status(401).json({\n            message: 'Invalid email or password'\n          }));\n        case 11:\n          // Generate a JWT token for the user\n          token = jwt.sign({\n            id: user.id\n          }, 'yourSecretKeyHere', {\n            expiresIn: '1h'\n          }); // Return a success response along with user information (excluding password)\n          res.status(200).json({\n            message: 'Login successful',\n            token: token,\n            user: {\n              name: user.name,\n              email: user.email,\n              cartItems: user.cartItems,\n              id: user.id\n            }\n          });\n        case 13:\n        case \"end\":\n          return _context9.stop();\n      }\n    }, _callee9);\n  }));\n  return function (_x15, _x16) {\n    return _ref8.apply(this, arguments);\n  };\n}());\napp.listen(8004, function () {\n  console.log('Server is listening on port 8004');\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2JvZHlQYXJzZXIiLCJfbW9uZ29kYiIsIl9wYXRoIiwiX2JjcnlwdCIsIl9jb3JzIiwiand0IiwiY29uZmlnIiwiYXBwIiwiZXhwcmVzcyIsImNvcnNPcHRpb25zIiwib3JpZ2luIiwibWV0aG9kcyIsImNyZWRlbnRpYWxzIiwib3B0aW9uc1N1Y2Nlc3NTdGF0dXMiLCJ1c2UiLCJjb3JzIiwiZGIiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJJIiwiY29uc29sZSIsImxvZyIsImNvbmNhdCIsIk1vbmdvQ2xpZW50IiwiY29ubmVjdCIsInVzZU5ld1VybFBhcnNlciIsInVzZVVuaWZpZWRUb3BvbG9neSIsInRoZW4iLCJjbGllbnQiLCJ1c2Vyc0NvbGxlY3Rpb24iLCJjb2xsZWN0aW9uIiwicnVuTWlncmF0aW9uIiwiX3J1bk1pZ3JhdGlvbiIsImFwcGx5IiwiYXJndW1lbnRzIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiX3JlZ2VuZXJhdG9yIiwibWFyayIsIl9jYWxsZWUiLCJyZXN1bHQiLCJ3cmFwIiwiX2NhbGxlZSQiLCJfY29udGV4dCIsInByZXYiLCJuZXh0IiwidXBkYXRlTWFueSIsIiRzZXQiLCJuYW1lIiwiZW1haWwiLCJwYXNzd29yZCIsInBhc3N3b3JkQ29uZmlybSIsIm5ld0ZpZWxkIiwic2VudCIsIm1vZGlmaWVkQ291bnQiLCJ0MCIsImVycm9yIiwic3RvcCIsImV4aXQiLCJib2R5UGFyc2VyIiwianNvbiIsInBhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwicG9zdCIsIl9yZWYiLCJfY2FsbGVlMiIsInJlcSIsInJlcyIsInJlZnJlc2hUb2tlbiIsImRlY29kZWRSZWZyZXNoVG9rZW4iLCJuZXdBY2Nlc3NUb2tlbiIsIl9jYWxsZWUyJCIsIl9jb250ZXh0MiIsImJvZHkiLCJhYnJ1cHQiLCJzdGF0dXMiLCJtZXNzYWdlIiwidmVyaWZ5Iiwic2lnbiIsImlkIiwiZXhwaXJlc0luIiwiYWNjZXNzVG9rZW4iLCJfeCIsIl94MiIsImdldCIsIl9yZWYyIiwiX2NhbGxlZTMiLCJwcm9kdWN0cyIsIl9jYWxsZWUzJCIsIl9jb250ZXh0MyIsImZpbmQiLCJ0b0FycmF5IiwiX3gzIiwiX3g0IiwiX3JlZjMiLCJfY2FsbGVlNCIsInRva2VuIiwidXNlcklkIiwidXNlciIsIl9jYWxsZWU0JCIsIl9jb250ZXh0NCIsInBhcmFtcyIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwiZmluZE9uZSIsIiRpbiIsImNhcnRJdGVtcyIsIl94NSIsIl94NiIsIl9yZWY0IiwiX2NhbGxlZTUiLCJwcm9kdWN0SWQiLCJwcm9kdWN0IiwiX2NhbGxlZTUkIiwiX2NvbnRleHQ1IiwiX3g3IiwiX3g4IiwiX3JlZjUiLCJfY2FsbGVlNiIsImRlY29kZWRUb2tlbiIsIl9jYWxsZWU2JCIsIl9jb250ZXh0NiIsInVwZGF0ZU9uZSIsIiRhZGRUb1NldCIsIl94OSIsIl94MTAiLCJfcmVmNiIsIl9jYWxsZWU3IiwiX3JlcSRwYXJhbXMiLCJfY2FsbGVlNyQiLCJfY29udGV4dDciLCIkcHVsbCIsIl94MTEiLCJfeDEyIiwiX3JlZjciLCJfY2FsbGVlOCIsIl9yZXEkYm9keSIsImV4aXN0aW5nVXNlciIsImhhc2hlZFBhc3N3b3JkIiwibmV3VXNlciIsIl9jYWxsZWU4JCIsIl9jb250ZXh0OCIsImJjcnlwdCIsImhhc2giLCJpbnNlcnRPbmUiLCJKV1RfU0VDUkVUIiwiSldUX0VYUElSRVNfSU4iLCJfeDEzIiwiX3gxNCIsIl9yZWY4IiwiX2NhbGxlZTkiLCJfcmVxJGJvZHkyIiwiaXNQYXNzd29yZFZhbGlkIiwiX2NhbGxlZTkkIiwiX2NvbnRleHQ5IiwiY29tcGFyZSIsIl94MTUiLCJfeDE2IiwibGlzdGVuIl0sInNvdXJjZVJvb3QiOiJEOlxcbGFyYWdvblxcd3d3XFxOb2RlIGV4ZXJjaXNlc1xccmVwb3NcXGZzdi1iYWNrLWVuZFxcc3JjXFwiLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInO1xyXG5pbXBvcnQgeyBNb25nb0NsaWVudCB9IGZyb20gJ21vbmdvZGInO1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHQnO1xyXG5pbXBvcnQgY29ycyBmcm9tICdjb3JzJztcclxuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpO1xyXG5cclxuXHJcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuY29uc3QgY29yc09wdGlvbnMgPSB7XHJcbiAgICBvcmlnaW46ICdodHRwOi8vbG9jYWxob3N0OjgwODAnLCAvLyBSZXBsYWNlIHdpdGggeW91ciBmcm9udGVuZCdzIFVSTFxyXG4gICAgbWV0aG9kczogJ0dFVCxIRUFELFBVVCxQQVRDSCxQT1NULERFTEVURScsXHJcbiAgICBjcmVkZW50aWFsczogdHJ1ZSxcclxuICAgIG9wdGlvbnNTdWNjZXNzU3RhdHVzOiAyMDQsXHJcbn07XHJcbmFwcC51c2UoY29ycyhjb3JzT3B0aW9ucykpO1xyXG5sZXQgZGI7IC8vIFdlJ2xsIGluaXRpYWxpemUgdGhpcyBvbmNlIGFuZCByZXVzZSBpdFxyXG5cclxuLy8gQ29ubmVjdCB0byBNb25nb0RCIG9uY2UgYW5kIHVzZSBpdCBhY3Jvc3MgcmVxdWVzdHNcclxuY29uc3QgY29ubmVjdGlvblN0cmluZyA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJIHx8ICdtb25nb2RiOi8vMTI3LjAuMC4xOjI3MDE3JztcclxuY29uc29sZS5sb2coYENvbm5lY3RpbmcgdG86ICR7Y29ubmVjdGlvblN0cmluZ31gKTtcclxuTW9uZ29DbGllbnQuY29ubmVjdChjb25uZWN0aW9uU3RyaW5nLCB7IHVzZU5ld1VybFBhcnNlcjogdHJ1ZSwgdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlIH0pXHJcbiAgICAudGhlbihjbGllbnQgPT4ge1xyXG4gICAgICAgIGRiID0gY2xpZW50LmRiKCd2dWUtZGInKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGVkIHRvIE1vbmdvREInKTtcclxuXHJcbiAgICAgICAgLy8gUnVuIHRoZSBtaWdyYXRpb24gc2NyaXB0IGhlcmVcclxuICAgICAgICBjb25zdCB1c2Vyc0NvbGxlY3Rpb24gPSBkYi5jb2xsZWN0aW9uKCd1c2VycycpO1xyXG5cclxuICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5NaWdyYXRpb24oKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2Vyc0NvbGxlY3Rpb24udXBkYXRlTWFueSh7fSwge1xyXG4gICAgICAgICAgICAgICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZENvbmZpcm06ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdGaWVsZDogJ2RlZmF1bHQgdmFsdWUnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRG9jdW1lbnRzIHVwZGF0ZWQ6JywgcmVzdWx0Lm1vZGlmaWVkQ291bnQpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgZG9jdW1lbnRzOicsIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgIH0pXHJcbiAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjb25uZWN0IHRvIE1vbmdvREInLCBlcnJvcik7XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xyXG4gICAgfSk7XHJcblxyXG5hcHAudXNlKGJvZHlQYXJzZXIuanNvbigpKTtcclxuYXBwLnVzZSgnL2Fzc2V0cycsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9hc3NldHMnKSkpO1xyXG5hcHAucG9zdCgnL2FwaS90b2tlbi9yZWZyZXNoJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IHJlZnJlc2hUb2tlbiB9ID0gcmVxLmJvZHk7IC8vIEdldHRpbmcgcmVmcmVzaFRva2VuIGZyb20gcmVxdWVzdCBib2R5XHJcblxyXG4gICAgaWYgKCFyZWZyZXNoVG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnUmVmcmVzaCB0b2tlbiBpcyByZXF1aXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBWYWxpZGF0ZSB0aGUgZXhpc3RpbmcgcmVmcmVzaCB0b2tlblxyXG4gICAgICAgIGNvbnN0IGRlY29kZWRSZWZyZXNoVG9rZW4gPSBqd3QudmVyaWZ5KHJlZnJlc2hUb2tlbiwgJ3lvdXJSZWZyZXNoU2VjcmV0S2V5SGVyZScpOyAvLyBJZGVhbGx5LCByZXBsYWNlICd5b3VyUmVmcmVzaFNlY3JldEtleUhlcmUnIHdpdGggYSBzZWNyZXQgc3RvcmVkIGluIGVudiB2YXJpYWJsZXNcclxuXHJcbiAgICAgICAgLy8gSWYgaXQncyB2YWxpZCwgZ2VuZXJhdGUgYSBuZXcgYWNjZXNzIHRva2VuXHJcbiAgICAgICAgY29uc3QgbmV3QWNjZXNzVG9rZW4gPSBqd3Quc2lnbih7IGlkOiBkZWNvZGVkUmVmcmVzaFRva2VuLmlkIH0sICd5b3VyU2VjcmV0S2V5SGVyZScsIHsgZXhwaXJlc0luOiAnMWgnIH0pOyAvLyBJZGVhbGx5LCByZXBsYWNlICd5b3VyU2VjcmV0S2V5SGVyZScgd2l0aCBhIHNlY3JldCBzdG9yZWQgaW4gZW52IHZhcmlhYmxlc1xyXG5cclxuICAgICAgICAvLyBTZW5kIHRoZSBuZXcgYWNjZXNzIHRva2VuIGJhY2sgdG8gdGhlIGNsaWVudFxyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgYWNjZXNzVG9rZW46IG5ld0FjY2Vzc1Rva2VuIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCByZWZyZXNoIHRva2VuJyB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG5hcHAuZ2V0KCcvYXBpL3Byb2R1Y3RzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCBwcm9kdWN0cyA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykuZmluZCh7fSkudG9BcnJheSgpO1xyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24ocHJvZHVjdHMpO1xyXG5cclxufSk7XHJcblxyXG5hcHAuZ2V0KCcvYXBpL3VzZXJzLzp1c2VySWQvY2FydCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIGNhcnQgZm9yIHVzZXJJZDonLCByZXEucGFyYW1zLnVzZXJJZCk7IC8vIEFjY2VzcyB1c2VySWQgZGlyZWN0bHlcclxuICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbjtcclxuICAgIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZmluZE9uZSh7IGlkOiB1c2VySWQgfSk7XHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbignQ291bGQgbm90IGZpbmQgdXNlciEnKTtcclxuXHJcbiAgICBjb25zdCBwcm9kdWN0cyA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykuZmluZCh7IGlkOiB7ICRpbjogdXNlci5jYXJ0SXRlbXMgfX0pLnRvQXJyYXkoKTtcclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHByb2R1Y3RzKTtcclxufSk7XHJcblxyXG5hcHAuZ2V0KCcvYXBpL3Byb2R1Y3RzLzpwcm9kdWN0SWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGNvbnN0IHsgcHJvZHVjdElkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykuZmluZE9uZSh7IGlkOiBwcm9kdWN0SWQgfSk7XHJcbiAgICBpZiAocHJvZHVjdCkge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHByb2R1Y3QpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbignQ291bGQgbm90IGZpbmQgdGhlIHByb2R1Y3QhJyk7XHJcbiAgICB9XHJcblxyXG59KTtcclxuXHJcbmFwcC5wb3N0KCcvYXBpL3VzZXJzLzp1c2VySWQvY2FydCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZGVjb2RlZFRva2VuID0gand0LnZlcmlmeSh0b2tlbiwgJ3lvdXJTZWNyZXRLZXlIZXJlJyk7XHJcbiAgICAgICAgY29uc3QgdXNlcklkID0gZGVjb2RlZFRva2VuLmlkO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXJJZClcclxuXHJcbiAgICAgICAgY29uc3QgeyBwcm9kdWN0SWQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgaWQ6IHVzZXJJZCB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbignQ291bGQgbm90IGZpbmQgdXNlciEnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJykudXBkYXRlT25lKHsgaWQ6IHVzZXJJZCB9LCB7XHJcbiAgICAgICAgICAgICRhZGRUb1NldDogeyBjYXJ0SXRlbXM6IHByb2R1Y3RJZCB9LFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9kdWN0cyA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykuZmluZCh7IGlkOiB7ICRpbjogdXNlci5jYXJ0SXRlbXMgfX0pLnRvQXJyYXkoKTtcclxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihwcm9kdWN0cyk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKCdVbmF1dGhvcml6ZWQnKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuYXBwLmRlbGV0ZSgnL2FwaS91c2Vycy86dXNlcklkL2NhcnQvOnByb2R1Y3RJZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgeyB1c2VySWQsIHByb2R1Y3RJZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgaWQ6IHVzZXJJZCB9KTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oJ0NvdWxkIG5vdCBmaW5kIHVzZXIhJyk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS51cGRhdGVPbmUoeyBpZDogdXNlcklkIH0sIHtcclxuICAgICAgICAkcHVsbDogeyBjYXJ0SXRlbXM6IHByb2R1Y3RJZCB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcHJvZHVjdHMgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdwcm9kdWN0cycpLmZpbmQoeyBpZDogeyAkaW46IHVzZXIuY2FydEl0ZW1zIH19KS50b0FycmF5KCk7XHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihwcm9kdWN0cyk7XHJcbn0pO1xyXG5cclxuYXBwLnBvc3QoJy9hcGkvcmVnaXN0ZXInLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBpZCwgbmFtZSwgZW1haWwsIHBhc3N3b3JkLCBwYXNzd29yZENvbmZpcm0gfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICBpZiAoIW5hbWUgfHwgIWVtYWlsIHx8ICFwYXNzd29yZCB8fCAhcGFzc3dvcmRDb25maXJtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdQbGVhc2UgZmlsbCBhbGwgZmllbGRzJyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmRDb25maXJtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdQYXNzd29yZHMgZG8gbm90IG1hdGNoJyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHMgYmFzZWQgb24gdGhlIGVtYWlsIGFkZHJlc3NcclxuICAgICAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmZpbmRPbmUoeyBlbWFpbCB9KTtcclxuICAgICAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdFbWFpbCBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApOyAvLyBEaXJlY3RseSB1c2luZyBhIG51bWJlciBhcyBzYWx0IHJvdW5kc1xyXG5cclxuICAgICAgICBjb25zdCBuZXdVc2VyID0ge1xyXG4gICAgICAgICAgICBpZCxcclxuICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgZW1haWwsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcclxuICAgICAgICAgICAgY2FydEl0ZW1zOiBbXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIEluc2VydCB0aGUgbmV3IHVzZXIgaW50byB0aGUgZGF0YWJhc2VcclxuICAgICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmluc2VydE9uZShuZXdVc2VyKTtcclxuXHJcbiAgICAgICAgLy8gR2VuZXJhdGUgYSBKV1QgdG9rZW4gZm9yIHRoZSB1c2VyXHJcbiAgICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih7IGlkOiBuZXdVc2VyLmlkIH0sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHsgZXhwaXJlc0luOiBwcm9jZXNzLmVudi5KV1RfRVhQSVJFU19JTiB9KTtcclxuXHJcblxyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1VzZXIgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICAgICAgICB0b2tlbixcclxuICAgICAgICAgICAgdXNlcjogeyBuYW1lLCBlbWFpbCB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZWdpc3RlcmluZyB1c2VyOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InIH0pO1xyXG4gICAgfVxyXG5cclxufSk7XHJcbmFwcC5wb3N0KCcvYXBpL2xvZ2luJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgZW1haWwgfSk7XHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaXNQYXNzd29yZFZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpO1xyXG4gICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgYSBKV1QgdG9rZW4gZm9yIHRoZSB1c2VyXHJcbiAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHsgaWQ6IHVzZXIuaWQgfSwgJ3lvdXJTZWNyZXRLZXlIZXJlJywgeyBleHBpcmVzSW46ICcxaCcgfSk7XHJcblxyXG4gICAgLy8gUmV0dXJuIGEgc3VjY2VzcyByZXNwb25zZSBhbG9uZyB3aXRoIHVzZXIgaW5mb3JtYXRpb24gKGV4Y2x1ZGluZyBwYXNzd29yZClcclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBtZXNzYWdlOiAnTG9naW4gc3VjY2Vzc2Z1bCcsXHJcbiAgICAgICAgdG9rZW4sXHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUsXHJcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxyXG4gICAgICAgICAgICBjYXJ0SXRlbXM6IHVzZXIuY2FydEl0ZW1zLFxyXG4gICAgICAgICAgICBpZDp1c2VyLmlkXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuXHJcbmFwcC5saXN0ZW4oODAwNCwgKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ1NlcnZlciBpcyBsaXN0ZW5pbmcgb24gcG9ydCA4MDA0Jyk7XHJcbn0pO1xyXG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsUUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsS0FBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssS0FBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBTU0sR0FBRyxHQUFHTixPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ25DQSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUNPLE1BQU0sQ0FBQyxDQUFDO0FBRzFCLElBQU1DLEdBQUcsR0FBRyxJQUFBQyxtQkFBTyxFQUFDLENBQUM7QUFDckIsSUFBTUMsV0FBVyxHQUFHO0VBQ2hCQyxNQUFNLEVBQUUsdUJBQXVCO0VBQUU7RUFDakNDLE9BQU8sRUFBRSxnQ0FBZ0M7RUFDekNDLFdBQVcsRUFBRSxJQUFJO0VBQ2pCQyxvQkFBb0IsRUFBRTtBQUMxQixDQUFDO0FBQ0ROLEdBQUcsQ0FBQ08sR0FBRyxDQUFDLElBQUFDLGdCQUFJLEVBQUNOLFdBQVcsQ0FBQyxDQUFDO0FBQzFCLElBQUlPLEVBQUUsQ0FBQyxDQUFDOztBQUVSO0FBQ0EsSUFBTUMsZ0JBQWdCLEdBQUdDLE9BQU8s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","map":{"version":3,"names":["_express","_interopRequireDefault","require","_bodyParser","_mongodb","_path","_bcrypt","_cors","jwt","config","app","express","corsOptions","origin","methods","credentials","optionsSuccessStatus","use","cors","db","connectionString","process","env","MONGODB_URI","console","log","concat","MongoClient","connect","useNewUrlParser","useUnifiedTopology","then","client","usersCollection","collection","runMigration","_runMigration","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee","result","wrap","_callee$","_context","prev","next","updateMany","$set","name","email","password","passwordConfirm","newField","sent","modifiedCount","t0","error","stop","exit","bodyParser","json","path","join","__dirname","post","_ref","_callee2","req","res","refreshToken","decodedRefreshToken","newAccessToken","_callee2$","_context2","body","abrupt","status","message","verify","sign","id","expiresIn","accessToken","_x","_x2","get","_ref2","_callee3","products","_callee3$","_context3","find","toArray","_x3","_x4","_ref3","_callee4","token","userId","user","_callee4$","_context4","params","headers","authorization","findOne","$in","cartItems","_x5","_x6","_ref4","_callee5","productId","product","_callee5$","_context5","_x7","_x8","_ref5","_callee6","decodedToken","_callee6$","_context6","updateOne","$addToSet","_x9","_x10","_ref6","_callee7","_req$params","_callee7$","_context7","$pull","_x11","_x12","_ref7","_callee8","_req$body","existingUser","hashedPassword","newUser","_callee8$","_context8","bcrypt","hash","insertOne","JWT_SECRET","JWT_EXPIRES_IN","_x13","_x14","_ref8","_callee9","_req$body2","isPasswordValid","_callee9$","_context9","compare","_x15","_x16","listen"],"sourceRoot":"D:\\laragon\\www\\Node exercises\\repos\\fsv-back-end\\src\\","sources":["server.js"],"sourcesContent":["import express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport { MongoClient } from 'mongodb';\r\nimport path from 'path';\r\nimport bcrypt from 'bcrypt';\r\nimport cors from 'cors';\r\nconst jwt = require('jsonwebtoken');\r\nrequire('dotenv').config();\r\n\r\n\r\nconst app = express();\r\nconst corsOptions = {\r\n    origin: 'http://localhost:8080', // Replace with your frontend's URL\r\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\r\n    credentials: true,\r\n    optionsSuccessStatus: 204,\r\n};\r\napp.use(cors(corsOptions));\r\nlet db; // We'll initialize this once and reuse it\r\n\r\n// Connect to MongoDB once and use it across requests\r\nconst connectionString = process.env.MONGODB_URI || 'mongodb://127.0.0.1:27017';\r\nconsole.log(`Connecting to: ${connectionString}`);\r\nMongoClient.connect(connectionString, { useNewUrlParser: true, useUnifiedTopology: true })\r\n    .then(client => {\r\n        db = client.db('vue-db');\r\n        console.log('Connected to MongoDB');\r\n\r\n        // Run the migration script here\r\n        const usersCollection = db.collection('users');\r\n\r\n        async function runMigration() {\r\n            try {\r\n                const result = await usersCollection.updateMany({}, {\r\n                    $set: {\r\n                        name: '',\r\n                        email: '',\r\n                        password: '',\r\n                        passwordConfirm: '',\r\n                        newField: 'default value'\r\n                    }\r\n                });\r\n                console.log('Documents updated:', result.modifiedCount);\r\n            } catch (error) {\r\n                console.error('Error updating documents:', error);\r\n            }\r\n        }\r\n\r\n\r\n\r\n    })\r\n    .catch(error => {\r\n        console.error('Failed to connect to MongoDB', error);\r\n        process.exit(1);\r\n    });\r\n\r\napp.use(bodyParser.json());\r\napp.use('/assets', express.static(path.join(__dirname, '../assets')));\r\napp.post('/api/token/refresh', async (req, res) => {\r\n    const { refreshToken } = req.body; // Getting refreshToken from request body\r\n\r\n    if (!refreshToken) {\r\n        return res.status(401).json({ message: 'Refresh token is required' });\r\n    }\r\n\r\n    try {\r\n        // Validate the existing refresh token\r\n        const decodedRefreshToken = jwt.verify(refreshToken, 'yourRefreshSecretKeyHere'); // Ideally, replace 'yourRefreshSecretKeyHere' with a secret stored in env variables\r\n\r\n        // If it's valid, generate a new access token\r\n        const newAccessToken = jwt.sign({ id: decodedRefreshToken.id }, 'yourSecretKeyHere', { expiresIn: '1h' }); // Ideally, replace 'yourSecretKeyHere' with a secret stored in env variables\r\n\r\n        // Send the new access token back to the client\r\n        res.status(200).json({ accessToken: newAccessToken });\r\n\r\n    } catch (error) {\r\n        res.status(401).json({ message: 'Invalid refresh token' });\r\n    }\r\n});\r\n\r\napp.get('/api/products', async (req, res) => {\r\n    const products = await db.collection('products').find({}).toArray();\r\n    res.status(200).json(products);\r\n\r\n});\r\n\r\napp.get('/api/users/:userId/cart', async (req, res) => {\r\n    console.log('Fetching cart for userId:', req.params.userId); // Access userId directly\r\n    const token = req.headers.authorization;\r\n    const { userId } = req.params;\r\n    const user = await db.collection('users').findOne({ id: userId });\r\n    if (!user) return res.status(404).json('Could not find user!');\r\n\r\n    const products = await db.collection('products').find({ id: { $in: user.cartItems }}).toArray();\r\n    res.status(200).json(products);\r\n});\r\n\r\napp.get('/api/products/:productId', async (req, res) => {\r\n    const { productId } = req.params;\r\n    const product = await db.collection('products').findOne({ id: productId });\r\n    if (product) {\r\n        res.status(200).json(product);\r\n    } else {\r\n        res.status(404).json('Could not find the product!');\r\n    }\r\n\r\n});\r\n\r\napp.post('/api/users/:userId/cart', async (req, res) => {\r\n    const token = req.headers.authorization;\r\n\r\n    try {\r\n        const decodedToken = jwt.verify(token, 'yourSecretKeyHere');\r\n        const userId = decodedToken.id;\r\n        console.log(userId)\r\n\r\n        const { productId } = req.body;\r\n\r\n        const user = await db.collection('users').findOne({ id: userId });\r\n\r\n        if (!user) {\r\n            return res.status(404).json('Could not find user!');\r\n        }\r\n\r\n        await db.collection('users').updateOne({ id: userId }, {\r\n            $addToSet: { cartItems: productId },\r\n        });\r\n\r\n        const products = await db.collection('products').find({ id: { $in: user.cartItems }}).toArray();\r\n        res.status(200).json(products);\r\n    } catch (error) {\r\n        res.status(401).json('Unauthorized');\r\n    }\r\n});\r\n\r\n\r\napp.delete('/api/users/:userId/cart/:productId', async (req, res) => {\r\n    const { userId, productId } = req.params;\r\n\r\n    const user = await db.collection('users').findOne({ id: userId });\r\n\r\n    if (!user) {\r\n        return res.status(404).json('Could not find user!');\r\n    }\r\n\r\n    await db.collection('users').updateOne({ id: userId }, {\r\n        $pull: { cartItems: productId },\r\n    });\r\n\r\n    const products = await db.collection('products').find({ id: { $in: user.cartItems }}).toArray();\r\n    res.status(200).json(products);\r\n});\r\n\r\napp.post('/api/register', async (req, res) => {\r\n    try {\r\n        const { id, name, email, password, passwordConfirm } = req.body;\r\n\r\n        if (!name || !email || !password || !passwordConfirm) {\r\n            return res.status(400).json({ message: 'Please fill all fields' });\r\n        }\r\n\r\n        if (password !== passwordConfirm) {\r\n            return res.status(400).json({ message: 'Passwords do not match' });\r\n        }\r\n\r\n        // Check if user already exists based on the email address\r\n        const existingUser = await db.collection('users').findOne({ email });\r\n        if (existingUser) {\r\n            return res.status(400).json({ message: 'Email is already registered' });\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 10); // Directly using a number as salt rounds\r\n\r\n        const newUser = {\r\n            id,\r\n            name,\r\n            email,\r\n            password: hashedPassword,\r\n            cartItems: []\r\n        };\r\n\r\n        // Insert the new user into the database\r\n        await db.collection('users').insertOne(newUser);\r\n\r\n        // Generate a JWT token for the user\r\n        const token = jwt.sign({ id: newUser.id }, process.env.JWT_SECRET, { expiresIn: process.env.JWT_EXPIRES_IN });\r\n\r\n\r\n        res.status(201).json({\r\n            message: 'User registered successfully',\r\n            token,\r\n            user: { name, email }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Error registering user:', error);\r\n        res.status(500).json({ message: 'Server error' });\r\n    }\r\n\r\n});\r\napp.post('/api/login', async (req, res) => {\r\n    const { email, password } = req.body;\r\n    const user = await db.collection('users').findOne({ email });\r\n    if (!user) {\r\n        return res.status(400).json({ message: 'Invalid email or password' });\r\n    }\r\n\r\n    const isPasswordValid = await bcrypt.compare(password, user.password);\r\n    if (!isPasswordValid) {\r\n        return res.status(401).json({ message: 'Invalid email or password' });\r\n    }\r\n\r\n    // Generate a JWT token for the user\r\n    const token = jwt.sign({ id: user.id }, 'yourSecretKeyHere', { expiresIn: '1h' });\r\n\r\n    // Return a success response along with user information (excluding password)\r\n    res.status(200).json({\r\n        message: 'Login successful',\r\n        token,\r\n        user: {\r\n            name: user.name,\r\n            email: user.email,\r\n            cartItems: user.cartItems,\r\n            id:user.id\r\n        }\r\n    });\r\n});\r\n\r\n\r\napp.listen(8004, () => {\r\n    console.log('Server is listening on port 8004');\r\n});\r\n"],"mappings":"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"}},"mtime":1694605173494},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"filename\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\controllers\\\\auth.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:development":{"value":{"code":"const bcrypt = require('bcrypt');\nconst jwt = require('jsonwebtoken');\nconst {\n  MongoClient\n} = require(\"mongodb\");\nconst client = new MongoClient(process.env.MONGODB_URI, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\n\n// Connect to the MongoDB database\n(async () => {\n  try {\n    console.log(\"Connecting to:\", process.env.MONGODB_URI);\n    await client.connect();\n    console.log(\"Connected to MongoDB\");\n  } catch (err) {\n    console.error(\"Error connecting to the database:\", err);\n  }\n})();\n\n// Make sure to close the connection when the app exits\nprocess.on(\"SIGINT\", () => {\n  client.close().then(() => {\n    console.log(\"MongoDB connection closed.\");\n    process.exit(0);\n  });\n});\nexports.login = async (req, res) => {\n  try {\n    const {\n      email,\n      password\n    } = req.body;\n    if (!email || !password) {\n      return res.status(400).render(\"login\", {\n        message: \"Please provide an email and password\"\n      });\n    }\n    const usersCollection = client.db(\"vue-db\").collection(\"users\");\n    const user = await usersCollection.findOne({\n      email\n    });\n    if (!user || !(await bcrypt.compare(password, user.password))) {\n      res.status(401).render(\"login\", {\n        message: \"Email or password is incorrect\"\n      });\n    } else {\n      const id = user._id;\n      const token = jwt.sign({\n        id\n      }, process.env.JWT_SECRET, {\n        expiresIn: process.env.JWT_EXPIRES_IN\n      });\n      console.log(\"The token is: \" + token);\n      const cookieOptions = {\n        expires: new Date(Date.now() + process.env.JWT_COOKIES_EXPIRES * 24 * 60 * 60 * 1000),\n        httpOnly: true\n      };\n      res.cookie(\"jwt\", token, cookieOptions);\n      res.status(200).redirect(\"/\");\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\nexports.register = async (req, res) => {\n  console.log(req.body);\n  const {\n    name,\n    email,\n    password,\n    passwordConfirm\n  } = req.body;\n  const usersCollection = client.db(\"vue-db\").collection(\"users\");\n  try {\n    const existingUser = await usersCollection.findOne({\n      email\n    });\n    if (existingUser) {\n      return res.render(\"register\", {\n        message: \"That email is already in use.\"\n      });\n    } else if (password !== passwordConfirm) {\n      return res.render(\"register\", {\n        message: \"Passwords do not match\"\n      });\n    }\n    const hashedPassword = await bcrypt.hash(password, 8);\n    console.log(hashedPassword);\n    const newUser = {\n      name: name,\n      email: email,\n      password: hashedPassword\n    };\n    await usersCollection.insertOne(newUser);\n    return res.render(\"register\", {\n      message: \"User registered\"\n    });\n  } catch (error) {\n    console.log(error);\n    res.status(500).send(\"Server Error\");\n  }\n};\nexports.logout = async (req, res) => {\n  res.clearCookie(\"jwt\"); // Clear the JWT cookie from the user's browser\n  res.status(200).redirect(\"/login\"); // Redirect the user to the login page after logout\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJiY3J5cHQiLCJyZXF1aXJlIiwiand0IiwiTW9uZ29DbGllbnQiLCJjbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VVbmlmaWVkVG9wb2xvZ3kiLCJjb25zb2xlIiwibG9nIiwiY29ubmVjdCIsImVyciIsImVycm9yIiwib24iLCJjbG9zZSIsInRoZW4iLCJleGl0IiwiZXhwb3J0cyIsImxvZ2luIiwicmVxIiwicmVzIiwiZW1haWwiLCJwYXNzd29yZCIsImJvZHkiLCJzdGF0dXMiLCJyZW5kZXIiLCJtZXNzYWdlIiwidXNlcnNDb2xsZWN0aW9uIiwiZGIiLCJjb2xsZWN0aW9uIiwidXNlciIsImZpbmRPbmUiLCJjb21wYXJlIiwiaWQiLCJfaWQiLCJ0b2tlbiIsInNpZ24iLCJKV1RfU0VDUkVUIiwiZXhwaXJlc0luIiwiSldUX0VYUElSRVNfSU4iLCJjb29raWVPcHRpb25zIiwiZXhwaXJlcyIsIkRhdGUiLCJub3ciLCJKV1RfQ09PS0lFU19FWFBJUkVTIiwiaHR0cE9ubHkiLCJjb29raWUiLCJyZWRpcmVjdCIsInJlZ2lzdGVyIiwibmFtZSIsInBhc3N3b3JkQ29uZmlybSIsImV4aXN0aW5nVXNlciIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsIm5ld1VzZXIiLCJpbnNlcnRPbmUiLCJzZW5kIiwibG9nb3V0IiwiY2xlYXJDb29raWUiXSwic291cmNlUm9vdCI6IkQ6XFxsYXJhZ29uXFx3d3dcXE5vZGUgZXhlcmNpc2VzXFxyZXBvc1xcZnN2LWJhY2stZW5kXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJhdXRoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJjcnlwdCA9IHJlcXVpcmUgKCdiY3J5cHQnKTtcclxuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcblxyXG5jb25zdCB7IE1vbmdvQ2xpZW50IH0gPSByZXF1aXJlKFwibW9uZ29kYlwiKTtcclxuY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJLCB7XHJcbiAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXHJcbiAgICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWUsXHJcbn0pO1xyXG5cclxuLy8gQ29ubmVjdCB0byB0aGUgTW9uZ29EQiBkYXRhYmFzZVxyXG4oYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbm5lY3RpbmcgdG86XCIsIHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJKTtcclxuICAgICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ29ubmVjdGVkIHRvIE1vbmdvREJcIik7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY29ubmVjdGluZyB0byB0aGUgZGF0YWJhc2U6XCIsIGVycik7XHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG5cclxuLy8gTWFrZSBzdXJlIHRvIGNsb3NlIHRoZSBjb25uZWN0aW9uIHdoZW4gdGhlIGFwcCBleGl0c1xyXG5wcm9jZXNzLm9uKFwiU0lHSU5UXCIsICgpID0+IHtcclxuICAgIGNsaWVudC5jbG9zZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTW9uZ29EQiBjb25uZWN0aW9uIGNsb3NlZC5cIik7XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KDApO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5leHBvcnRzLmxvZ2luID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcclxuICAgICAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnJlbmRlcihcImxvZ2luXCIsIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiUGxlYXNlIHByb3ZpZGUgYW4gZW1haWwgYW5kIHBhc3N3b3JkXCIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdXNlcnNDb2xsZWN0aW9uID0gY2xpZW50LmRiKFwidnVlLWRiXCIpLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdXNlcnNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbCB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyIHx8ICEoYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpKSkge1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwMSkucmVuZGVyKFwibG9naW5cIiwge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJFbWFpbCBvciBwYXNzd29yZCBpcyBpbmNvcnJlY3RcIixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSB1c2VyLl9pZDtcclxuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih7IGlkIH0sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHtcclxuICAgICAgICAgICAgICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSB0b2tlbiBpczogXCIgKyB0b2tlbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvb2tpZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBleHBpcmVzOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgcHJvY2Vzcy5lbnYuSldUX0NPT0tJRVNfRVhQSVJFUyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxyXG4gICAgICAgICAgICAgICAgaHR0cE9ubHk6IHRydWUsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlcy5jb29raWUoXCJqd3RcIiwgdG9rZW4sIGNvb2tpZU9wdGlvbnMpO1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkucmVkaXJlY3QoXCIvXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgfVxyXG59O1xyXG5leHBvcnRzLnJlZ2lzdGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhyZXEuYm9keSk7XHJcblxyXG4gICAgY29uc3QgeyBuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIHBhc3N3b3JkQ29uZmlybSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc3QgdXNlcnNDb2xsZWN0aW9uID0gY2xpZW50LmRiKFwidnVlLWRiXCIpLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHVzZXJzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWwgfSk7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnJlbmRlcihcInJlZ2lzdGVyXCIsIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiVGhhdCBlbWFpbCBpcyBhbHJlYWR5IGluIHVzZS5cIixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmRDb25maXJtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMucmVuZGVyKFwicmVnaXN0ZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJQYXNzd29yZHMgZG8gbm90IG1hdGNoXCIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgOCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coaGFzaGVkUGFzc3dvcmQpO1xyXG5cclxuICAgICAgICBjb25zdCBuZXdVc2VyID0ge1xyXG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhd2FpdCB1c2Vyc0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld1VzZXIpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnJlbmRlcihcInJlZ2lzdGVyXCIsIHtcclxuICAgICAgICAgICAgbWVzc2FnZTogXCJVc2VyIHJlZ2lzdGVyZWRcIixcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiU2VydmVyIEVycm9yXCIpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0cy5sb2dvdXQgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgICAgICByZXMuY2xlYXJDb29raWUoXCJqd3RcIik7IC8vIENsZWFyIHRoZSBKV1QgY29va2llIGZyb20gdGhlIHVzZXIncyBicm93c2VyXHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLnJlZGlyZWN0KFwiL2xvZ2luXCIpOyAvLyBSZWRpcmVjdCB0aGUgdXNlciB0byB0aGUgbG9naW4gcGFnZSBhZnRlciBsb2dvdXRcclxufTtcclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUUsUUFBUSxDQUFDO0FBQ2pDLE1BQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUVuQyxNQUFNO0VBQUVFO0FBQVksQ0FBQyxH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","map":{"version":3,"names":["bcrypt","require","jwt","MongoClient","client","process","env","MONGODB_URI","useNewUrlParser","useUnifiedTopology","console","log","connect","err","error","on","close","then","exit","exports","login","req","res","email","password","body","status","render","message","usersCollection","db","collection","user","findOne","compare","id","_id","token","sign","JWT_SECRET","expiresIn","JWT_EXPIRES_IN","cookieOptions","expires","Date","now","JWT_COOKIES_EXPIRES","httpOnly","cookie","redirect","register","name","passwordConfirm","existingUser","hashedPassword","hash","newUser","insertOne","send","logout","clearCookie"],"sourceRoot":"D:\\laragon\\www\\Node exercises\\repos\\fsv-back-end\\controllers\\","sources":["auth.js"],"sourcesContent":["const bcrypt = require ('bcrypt');\r\nconst jwt = require('jsonwebtoken');\r\n\r\nconst { MongoClient } = require(\"mongodb\");\r\nconst client = new MongoClient(process.env.MONGODB_URI, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true,\r\n});\r\n\r\n// Connect to the MongoDB database\r\n(async () => {\r\n    try {\r\n        console.log(\"Connecting to:\", process.env.MONGODB_URI);\r\n        await client.connect();\r\n        console.log(\"Connected to MongoDB\");\r\n    } catch (err) {\r\n        console.error(\"Error connecting to the database:\", err);\r\n    }\r\n})();\r\n\r\n\r\n// Make sure to close the connection when the app exits\r\nprocess.on(\"SIGINT\", () => {\r\n    client.close().then(() => {\r\n        console.log(\"MongoDB connection closed.\");\r\n        process.exit(0);\r\n    });\r\n});\r\nexports.login = async (req, res) => {\r\n    try {\r\n        const { email, password } = req.body;\r\n        if (!email || !password) {\r\n            return res.status(400).render(\"login\", {\r\n                message: \"Please provide an email and password\",\r\n            });\r\n        }\r\n\r\n        const usersCollection = client.db(\"vue-db\").collection(\"users\");\r\n        const user = await usersCollection.findOne({ email });\r\n\r\n        if (!user || !(await bcrypt.compare(password, user.password))) {\r\n            res.status(401).render(\"login\", {\r\n                message: \"Email or password is incorrect\",\r\n            });\r\n        } else {\r\n            const id = user._id;\r\n            const token = jwt.sign({ id }, process.env.JWT_SECRET, {\r\n                expiresIn: process.env.JWT_EXPIRES_IN,\r\n            });\r\n            console.log(\"The token is: \" + token);\r\n            const cookieOptions = {\r\n                expires: new Date(Date.now() + process.env.JWT_COOKIES_EXPIRES * 24 * 60 * 60 * 1000),\r\n                httpOnly: true,\r\n            };\r\n            res.cookie(\"jwt\", token, cookieOptions);\r\n            res.status(200).redirect(\"/\");\r\n        }\r\n    } catch (error) {\r\n        console.log(error);\r\n    }\r\n};\r\nexports.register = async (req, res) => {\r\n    console.log(req.body);\r\n\r\n    const { name, email, password, passwordConfirm } = req.body;\r\n\r\n    const usersCollection = client.db(\"vue-db\").collection(\"users\");\r\n\r\n    try {\r\n        const existingUser = await usersCollection.findOne({ email });\r\n        if (existingUser) {\r\n            return res.render(\"register\", {\r\n                message: \"That email is already in use.\",\r\n            });\r\n        } else if (password !== passwordConfirm) {\r\n            return res.render(\"register\", {\r\n                message: \"Passwords do not match\",\r\n            });\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 8);\r\n        console.log(hashedPassword);\r\n\r\n        const newUser = {\r\n            name: name,\r\n            email: email,\r\n            password: hashedPassword,\r\n        };\r\n\r\n        await usersCollection.insertOne(newUser);\r\n\r\n        return res.render(\"register\", {\r\n            message: \"User registered\",\r\n        });\r\n    } catch (error) {\r\n        console.log(error);\r\n        res.status(500).send(\"Server Error\");\r\n    }\r\n};\r\n\r\nexports.logout = async (req, res) => {\r\n        res.clearCookie(\"jwt\"); // Clear the JWT cookie from the user's browser\r\n        res.status(200).redirect(\"/login\"); // Redirect the user to the login page after logout\r\n};\r\n\r\n"],"mappings":"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"}},"mtime":1691738442115}}