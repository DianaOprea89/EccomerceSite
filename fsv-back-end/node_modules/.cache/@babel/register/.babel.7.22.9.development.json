{"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"filename\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\src\\\\server.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"transform-runtime\",\"visitor\":{\"MemberExpression\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"Identifier\":{\"enter\":[null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"regenerator\":true},\"externalDependencies\":[]},{\"key\":\"transform-unicode-sets-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-class-static-block\",\"visitor\":{\"ClassBody\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-private-property-in-object\",\"visitor\":{\"BinaryExpression\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-private-methods\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-numeric-separator\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"BigIntLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-logical-assignment-operators\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-nullish-coalescing-operator\",\"visitor\":{\"LogicalExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-chaining\",\"visitor\":{\"OptionalCallExpression\":{\"enter\":[null]},\"OptionalMemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-json-strings\",\"visitor\":{\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-catch-binding\",\"visitor\":{\"CatchClause\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-parameters\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-generator-functions\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-to-generator\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-exponentiation-operator\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-template-literals\",\"visitor\":{\"TaggedTemplateExpression\":{\"enter\":[null]},\"TemplateLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-literals\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-function-name\",\"visitor\":{\"FunctionExpression\":{\"exit\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-arrow-functions\",\"visitor\":{\"ArrowFunctionExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoped-functions\",\"visitor\":{\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-classes\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-super\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-shorthand-properties\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-duplicate-keys\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-computed-properties\",\"visitor\":{\"ObjectExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-for-of\",\"visitor\":{\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-sticky-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-escapes\",\"visitor\":{\"Identifier\":{\"enter\":[null]},\"TemplateElement\":{\"enter\":[null]},\"_exploded\":true,\"StringLiteral\":{\"enter\":[null]},\"DirectiveLiteral\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-spread\",\"visitor\":{\"ArrayExpression\":{\"enter\":[null]},\"CallExpression\":{\"enter\":[null]},\"NewExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-destructuring\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"VariableDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoping\",\"visitor\":{\"VariableDeclaration\":{\"enter\":[null,null]},\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-typeof-symbol\",\"visitor\":{\"UnaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"BlockStatement\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"Program\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"SwitchStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"StaticBlock\":{\"enter\":[null]},\"TSModuleBlock\":{\"enter\":[null]},\"AssignmentPattern\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-new-target\",\"visitor\":{\"MetaProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-regenerator\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassPrivateMethod\":{\"enter\":[null],\"exit\":[null]},\"FunctionDeclaration\":{\"exit\":[null]},\"FunctionExpression\":{\"exit\":[null]},\"ArrowFunctionExpression\":{\"exit\":[null]},\"MemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-member-expression-literals\",\"visitor\":{\"MemberExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-property-literals\",\"visitor\":{\"ObjectProperty\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-reserved-words\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null,null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-export-namespace-from\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dynamic-import\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-import-meta\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.22.9:development":{"value":{"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _express = _interopRequireDefault(require(\"express\"));\nvar _bodyParser = _interopRequireDefault(require(\"body-parser\"));\nvar _mongodb = require(\"mongodb\");\nvar _path = _interopRequireDefault(require(\"path\"));\nvar _bcrypt = _interopRequireDefault(require(\"bcrypt\"));\nvar _cors = _interopRequireDefault(require(\"cors\"));\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2[\"default\"])(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nvar jwt = require('jsonwebtoken');\nrequire('dotenv').config();\nvar app = (0, _express[\"default\"])();\nvar corsOptions = {\n  origin: 'http://localhost:8080',\n  methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n  credentials: true,\n  optionsSuccessStatus: 204\n};\napp.use((0, _cors[\"default\"])(corsOptions));\nvar db;\nvar connectionString = process.env.MONGODB_URI || 'mongodb://127.0.0.1:27017';\nconsole.log(\"Connecting to: \".concat(connectionString));\n_mongodb.MongoClient.connect(connectionString, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n}).then(function (client) {\n  db = client.db('vue-db');\n  console.log('Connected to MongoDB');\n\n  // Run the migration script here\n  var usersCollection = db.collection('users');\n  function runMigration() {\n    return _runMigration.apply(this, arguments);\n  }\n  function _runMigration() {\n    _runMigration = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var result;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return usersCollection.updateMany({}, {\n              $set: {\n                name: '',\n                email: '',\n                password: '',\n                passwordConfirm: '',\n                newField: 'default value'\n              }\n            });\n          case 3:\n            result = _context.sent;\n            console.log('Documents updated:', result.modifiedCount);\n            _context.next = 10;\n            break;\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.error('Error updating documents:', _context.t0);\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n    return _runMigration.apply(this, arguments);\n  }\n})[\"catch\"](function (error) {\n  console.error('Failed to connect to MongoDB', error);\n  process.exit(1);\n});\napp.use(_bodyParser[\"default\"].json());\napp.use(_express[\"default\"][\"static\"](_path[\"default\"].join(__dirname, '../assets')));\napp.use(function (req, res, next) {\n  console.log(\"Request received: \".concat(req.method, \" \").concat(req.url));\n  next();\n});\nfunction authenticateToken(req, res, next) {\n  var token = req.header('Authorization');\n  if (!token) {\n    return res.status(401).json({\n      message: 'Unauthorized'\n    });\n  }\n  jwt.verify(token, process.env.JWT_SECRET, function (err, user) {\n    if (err) {\n      return res.status(403).json({\n        message: 'Forbidden'\n      });\n    }\n    req.user = user;\n    next();\n  });\n}\napp.get('/api/protected', authenticateToken, function (req, res) {\n  res.json({\n    message: 'Protected route accessed'\n  });\n});\napp.get('/api/products', /*#__PURE__*/function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(req, res) {\n    var products;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return db.collection('products').find({}).toArray();\n        case 3:\n          products = _context2.sent;\n          res.status(200).json(products);\n          _context2.next = 11;\n          break;\n        case 7:\n          _context2.prev = 7;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.error('Error fetching products:', _context2.t0);\n          res.status(500).json({\n            error: 'Internal Server Error'\n          });\n        case 11:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[0, 7]]);\n  }));\n  return function (_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}());\napp.post('/api/userData', /*#__PURE__*/function () {\n  var _ref2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(req, res) {\n    var _req$body, email, password, user, isPasswordValid;\n    return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _req$body = req.body, email = _req$body.email, password = _req$body.password;\n          _context3.next = 3;\n          return db.collection('users').findOne({\n            email: email\n          });\n        case 3:\n          user = _context3.sent;\n          if (user) {\n            _context3.next = 6;\n            break;\n          }\n          return _context3.abrupt(\"return\", res.status(404).json({\n            message: 'User not found'\n          }));\n        case 6:\n          _context3.next = 8;\n          return _bcrypt[\"default\"].compare(password, user.password);\n        case 8:\n          isPasswordValid = _context3.sent;\n          if (isPasswordValid) {\n            _context3.next = 11;\n            break;\n          }\n          return _context3.abrupt(\"return\", res.status(401).json({\n            message: 'Unauthorized'\n          }));\n        case 11:\n          res.status(200).json({\n            name: user.name,\n            email: user.email,\n            id: user.id,\n            cartItems: user.cartItems\n          });\n        case 12:\n        case \"end\":\n          return _context3.stop();\n      }\n    }, _callee3);\n  }));\n  return function (_x3, _x4) {\n    return _ref2.apply(this, arguments);\n  };\n}());\napp.post('/api/cart/add', /*#__PURE__*/function () {\n  var _ref3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(req, res) {\n    var _req$body2, email, password, productId, user, isPasswordValid, product, cartItemIndex, updatedUser;\n    return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _req$body2 = req.body, email = _req$body2.email, password = _req$body2.password, productId = _req$body2.productId;\n          _context4.next = 3;\n          return db.collection('users').findOne({\n            email: email\n          });\n        case 3:\n          user = _context4.sent;\n          if (user) {\n            _context4.next = 6;\n            break;\n          }\n          return _context4.abrupt(\"return\", res.status(404).json('Could not find user!'));\n        case 6:\n          _context4.next = 8;\n          return _bcrypt[\"default\"].compare(password, user.password);\n        case 8:\n          isPasswordValid = _context4.sent;\n          if (isPasswordValid) {\n            _context4.next = 11;\n            break;\n          }\n          return _context4.abrupt(\"return\", res.status(401).json('Unauthorized'));\n        case 11:\n          _context4.next = 13;\n          return db.collection('products').findOne({\n            id: productId\n          });\n        case 13:\n          product = _context4.sent;\n          if (product) {\n            _context4.next = 16;\n            break;\n          }\n          return _context4.abrupt(\"return\", res.status(404).json('Could not find product!'));\n        case 16:\n          console.log(\"Product added to cart successfully\");\n\n          // Check if the product already exists in the cart\n          cartItemIndex = user.cartItems.findIndex(function (item) {\n            return item.productId === productId;\n          });\n          if (cartItemIndex === -1) {\n            // If the product doesn't exist in the cart, add it as a new object\n            user.cartItems.push({\n              productId: productId,\n              count: 1\n            });\n          } else {\n            // If the product already exists, increment its count\n            user.cartItems[cartItemIndex].count++;\n          }\n\n          // Update the user's cartItems\n          _context4.next = 21;\n          return db.collection('users').updateOne({\n            id: user.id\n          }, {\n            $set: {\n              cartItems: user.cartItems\n            }\n          });\n        case 21:\n          _context4.next = 23;\n          return db.collection('users').findOne({\n            id: user.id\n          });\n        case 23:\n          updatedUser = _context4.sent;\n          res.status(200).json(updatedUser.cartItems);\n        case 25:\n        case \"end\":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function (_x5, _x6) {\n    return _ref3.apply(this, arguments);\n  };\n}());\napp.get('/api/users/:userId/cart', /*#__PURE__*/function () {\n  var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee5(req, res) {\n    var userId, user, userCartItems, productsInCart, _iterator, _step, cartItem, productId, product;\n    return _regenerator[\"default\"].wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.prev = 0;\n          userId = req.params.userId;\n          _context5.next = 4;\n          return db.collection('users').findOne({\n            id: userId\n          });\n        case 4:\n          user = _context5.sent;\n          if (user) {\n            _context5.next = 7;\n            break;\n          }\n          return _context5.abrupt(\"return\", res.status(404).json('Could not find user with id: ' + userId));\n        case 7:\n          userCartItems = user.cartItems;\n          productsInCart = [];\n          _iterator = _createForOfIteratorHelper(userCartItems);\n          _context5.prev = 10;\n          _iterator.s();\n        case 12:\n          if ((_step = _iterator.n()).done) {\n            _context5.next = 21;\n            break;\n          }\n          cartItem = _step.value;\n          productId = cartItem.productId;\n          _context5.next = 17;\n          return db.collection('products').findOne({\n            id: productId\n          });\n        case 17:\n          product = _context5.sent;\n          if (product) {\n            // Add the product with its count to productsInCart\n            productsInCart.push({\n              product: product,\n              count: cartItem.count\n            });\n          }\n        case 19:\n          _context5.next = 12;\n          break;\n        case 21:\n          _context5.next = 26;\n          break;\n        case 23:\n          _context5.prev = 23;\n          _context5.t0 = _context5[\"catch\"](10);\n          _iterator.e(_context5.t0);\n        case 26:\n          _context5.prev = 26;\n          _iterator.f();\n          return _context5.finish(26);\n        case 29:\n          res.status(200).json(productsInCart);\n          _context5.next = 36;\n          break;\n        case 32:\n          _context5.prev = 32;\n          _context5.t1 = _context5[\"catch\"](0);\n          console.error('Error fetching cart items:', _context5.t1);\n          res.status(500).json({\n            error: 'Internal Server Error'\n          });\n        case 36:\n        case \"end\":\n          return _context5.stop();\n      }\n    }, _callee5, null, [[0, 32], [10, 23, 26, 29]]);\n  }));\n  return function (_x7, _x8) {\n    return _ref4.apply(this, arguments);\n  };\n}());\napp.get('/api/products/:productId/:userId', /*#__PURE__*/function () {\n  var _ref5 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee6(req, res) {\n    var productId, userId, product;\n    return _regenerator[\"default\"].wrap(function _callee6$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          productId = req.params.productId;\n          userId = req.params.userId;\n          _context6.next = 4;\n          return db.collection('products').findOne({\n            id: productId\n          });\n        case 4:\n          product = _context6.sent;\n          if (product) {\n            res.status(200).json(product);\n          } else {\n            res.status(404).json('Could not find the product!');\n          }\n        case 6:\n        case \"end\":\n          return _context6.stop();\n      }\n    }, _callee6);\n  }));\n  return function (_x9, _x10) {\n    return _ref5.apply(this, arguments);\n  };\n}());\napp[\"delete\"]('/api/users/:userId/cart/:productId', /*#__PURE__*/function () {\n  var _ref6 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee7(req, res) {\n    var _req$params, userId, productId, user, updatedCartItems, products;\n    return _regenerator[\"default\"].wrap(function _callee7$(_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _req$params = req.params, userId = _req$params.userId, productId = _req$params.productId;\n          console.log(\"Removing product with id \".concat(productId, \" from cart of user with id \").concat(userId));\n          _context7.next = 4;\n          return db.collection('users').findOne({\n            id: userId\n          });\n        case 4:\n          user = _context7.sent;\n          if (user) {\n            _context7.next = 8;\n            break;\n          }\n          console.log('User not found.');\n          return _context7.abrupt(\"return\", res.status(404).json('Could not find user!'));\n        case 8:\n          updatedCartItems = user.cartItems.map(function (cartItem) {\n            if (cartItem.id === productId) {\n              console.log(\"Decrementing count of product \".concat(productId, \" in cart.\"));\n              return _objectSpread(_objectSpread({}, cartItem), {}, {\n                count: cartItem.count - 1\n              });\n            }\n            return cartItem;\n          });\n          console.log('Updated cart items:', updatedCartItems);\n          _context7.next = 12;\n          return db.collection('users').updateOne({\n            id: userId\n          }, {\n            $set: {\n              cartItems: updatedCartItems\n            }\n          });\n        case 12:\n          console.log('Cart updated in the database.');\n          _context7.next = 15;\n          return db.collection('products').find({\n            id: {\n              $in: user.cartItems\n            }\n          }).toArray();\n        case 15:\n          products = _context7.sent;\n          res.status(200).json(products);\n        case 17:\n        case \"end\":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function (_x11, _x12) {\n    return _ref6.apply(this, arguments);\n  };\n}());\napp.post('/api/register', /*#__PURE__*/function () {\n  var _ref7 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee8(req, res) {\n    var _req$body3, id, name, email, password, passwordConfirm, existingUser, hashedPassword, newUser;\n    return _regenerator[\"default\"].wrap(function _callee8$(_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n          _req$body3 = req.body, id = _req$body3.id, name = _req$body3.name, email = _req$body3.email, password = _req$body3.password, passwordConfirm = _req$body3.passwordConfirm;\n          if (!(!name || !email || !password || !passwordConfirm)) {\n            _context8.next = 4;\n            break;\n          }\n          return _context8.abrupt(\"return\", res.status(400).json({\n            message: 'Please fill all fields'\n          }));\n        case 4:\n          if (!(password !== passwordConfirm)) {\n            _context8.next = 6;\n            break;\n          }\n          return _context8.abrupt(\"return\", res.status(400).json({\n            message: 'Passwords do not match'\n          }));\n        case 6:\n          _context8.next = 8;\n          return db.collection('users').findOne({\n            email: email\n          });\n        case 8:\n          existingUser = _context8.sent;\n          if (!existingUser) {\n            _context8.next = 11;\n            break;\n          }\n          return _context8.abrupt(\"return\", res.status(400).json({\n            message: 'Email is already registered'\n          }));\n        case 11:\n          _context8.next = 13;\n          return _bcrypt[\"default\"].hash(password, 10);\n        case 13:\n          hashedPassword = _context8.sent;\n          newUser = {\n            id: id,\n            name: name,\n            email: email,\n            password: hashedPassword,\n            cartItems: []\n          };\n          _context8.next = 17;\n          return db.collection('users').insertOne(newUser);\n        case 17:\n          res.status(201).json({\n            message: 'User registered successfully',\n            user: {\n              name: name,\n              email: email\n            }\n          });\n          _context8.next = 24;\n          break;\n        case 20:\n          _context8.prev = 20;\n          _context8.t0 = _context8[\"catch\"](0);\n          console.error('Error registering user:', _context8.t0);\n          res.status(500).json({\n            message: 'Server error'\n          });\n        case 24:\n        case \"end\":\n          return _context8.stop();\n      }\n    }, _callee8, null, [[0, 20]]);\n  }));\n  return function (_x13, _x14) {\n    return _ref7.apply(this, arguments);\n  };\n}());\napp.post('/api/login', /*#__PURE__*/function () {\n  var _ref8 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee9(req, res) {\n    var _req$body4, email, password, user, isPasswordValid;\n    return _regenerator[\"default\"].wrap(function _callee9$(_context9) {\n      while (1) switch (_context9.prev = _context9.next) {\n        case 0:\n          _req$body4 = req.body, email = _req$body4.email, password = _req$body4.password;\n          console.log('Received login request with email:', email);\n          _context9.next = 4;\n          return db.collection('users').findOne({\n            email: email\n          });\n        case 4:\n          user = _context9.sent;\n          console.log('Found user:', user);\n          if (user) {\n            _context9.next = 8;\n            break;\n          }\n          return _context9.abrupt(\"return\", res.status(400).json({\n            message: 'Invalid email or password'\n          }));\n        case 8:\n          _context9.next = 10;\n          return _bcrypt[\"default\"].compare(password, user.password);\n        case 10:\n          isPasswordValid = _context9.sent;\n          console.log('Password validation result:', isPasswordValid);\n          if (isPasswordValid) {\n            _context9.next = 14;\n            break;\n          }\n          return _context9.abrupt(\"return\", res.status(401).json({\n            message: 'Invalid email or password'\n          }));\n        case 14:\n          res.status(200).json({\n            message: 'Login successful',\n            user: {\n              name: user.name,\n              email: user.email,\n              cartItems: user.cartItems,\n              id: user.id\n            }\n          });\n        case 15:\n        case \"end\":\n          return _context9.stop();\n      }\n    }, _callee9);\n  }));\n  return function (_x15, _x16) {\n    return _ref8.apply(this, arguments);\n  };\n}());\napp.listen(8006, function () {\n  console.log('Server is listening on port 8006');\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2JvZHlQYXJzZXIiLCJfbW9uZ29kYiIsIl9wYXRoIiwiX2JjcnlwdCIsIl9jb3JzIiwib3duS2V5cyIsIm9iamVjdCIsImVudW1lcmFibGVPbmx5Iiwia2V5cyIsIk9iamVjdCIsImdldE93blByb3BlcnR5U3ltYm9scyIsInN5bWJvbHMiLCJmaWx0ZXIiLCJzeW0iLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJmb3JFYWNoIiwia2V5IiwiX2RlZmluZVByb3BlcnR5MiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciIsIm8iLCJhbGxvd0FycmF5TGlrZSIsIml0IiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJBcnJheSIsImlzQXJyYXkiLCJfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkiLCJGIiwicyIsIm4iLCJkb25lIiwidmFsdWUiLCJlIiwiX2UiLCJmIiwiVHlwZUVycm9yIiwibm9ybWFsQ29tcGxldGlvbiIsImRpZEVyciIsImVyciIsImNhbGwiLCJzdGVwIiwibmV4dCIsIl9lMiIsIm1pbkxlbiIsIl9hcnJheUxpa2VUb0FycmF5IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJzbGljZSIsImNvbnN0cnVjdG9yIiwibmFtZSIsImZyb20iLCJ0ZXN0IiwiYXJyIiwibGVuIiwiYXJyMiIsImp3dCIsImNvbmZpZyIsImFwcCIsImV4cHJlc3MiLCJjb3JzT3B0aW9ucyIsIm9yaWdpbiIsIm1ldGhvZHMiLCJjcmVkZW50aWFscyIsIm9wdGlvbnNTdWNjZXNzU3RhdHVzIiwidXNlIiwiY29ycyIsImRiIiwiY29ubmVjdGlvblN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsImNvbnNvbGUiLCJsb2ciLCJjb25jYXQiLCJNb25nb0NsaWVudCIsImNvbm5lY3QiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VVbmlmaWVkVG9wb2xvZ3kiLCJ0aGVuIiwiY2xpZW50IiwidXNlcnNDb2xsZWN0aW9uIiwiY29sbGVjdGlvbiIsInJ1bk1pZ3JhdGlvbiIsIl9ydW5NaWdyYXRpb24iLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfcmVnZW5lcmF0b3IiLCJtYXJrIiwiX2NhbGxlZSIsInJlc3VsdCIsIndyYXAiLCJfY2FsbGVlJCIsIl9jb250ZXh0IiwicHJldiIsInVwZGF0ZU1hbnkiLCIkc2V0IiwiZW1haWwiLCJwYXNzd29yZCIsInBhc3N3b3JkQ29uZmlybSIsIm5ld0ZpZWxkIiwic2VudCIsIm1vZGlmaWVkQ291bnQiLCJ0MCIsImVycm9yIiwic3RvcCIsImV4aXQiLCJib2R5UGFyc2VyIiwianNvbiIsInBhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwicmVxIiwicmVzIiwibWV0aG9kIiwidXJsIiwiYXV0aGVudGljYXRlVG9rZW4iLCJ0b2tlbiIsImhlYWRlciIsInN0YXR1cyIsIm1lc3NhZ2UiLCJ2ZXJpZnkiLCJKV1RfU0VDUkVUIiwidXNlciIsImdldCIsIl9yZWYiLCJfY2FsbGVlMiIsInByb2R1Y3RzIiwiX2NhbGxlZTIkIiwiX2NvbnRleHQyIiwiZmluZCIsInRvQXJyYXkiLCJfeCIsIl94MiIsInBvc3QiLCJfcmVmMiIsIl9jYWxsZWUzIiwiX3JlcSRib2R5IiwiaXNQYXNzd29yZFZhbGlkIiwiX2NhbGxlZTMkIiwiX2NvbnRleHQzIiwiYm9keSIsImZpbmRPbmUiLCJhYnJ1cHQiLCJiY3J5cHQiLCJjb21wYXJlIiwiaWQiLCJjYXJ0SXRlbXMiLCJfeDMiLCJfeDQiLCJfcmVmMyIsIl9jYWxsZWU0IiwiX3JlcSRib2R5MiIsInByb2R1Y3RJZCIsInByb2R1Y3QiLCJjYXJ0SXRlbUluZGV4IiwidXBkYXRlZFVzZXIiLCJfY2FsbGVlNCQiLCJfY29udGV4dDQiLCJmaW5kSW5kZXgiLCJpdGVtIiwiY291bnQiLCJ1cGRhdGVPbmUiLCJfeDUiLCJfeDYiLCJfcmVmNCIsIl9jYWxsZWU1IiwidXNlcklkIiwidXNlckNhcnRJdGVtcyIsInByb2R1Y3RzSW5DYXJ0IiwiX2l0ZXJhdG9yIiwiX3N0ZXAiLCJjYXJ0SXRlbSIsIl9jYWxsZWU1JCIsIl9jb250ZXh0NSIsInBhcmFtcyIsImZpbmlzaCIsInQxIiwiX3g3IiwiX3g4IiwiX3JlZjUiLCJfY2FsbGVlNiIsIl9jYWxsZWU2JCIsIl9jb250ZXh0NiIsIl94OSIsIl94MTAiLCJfcmVmNiIsIl9jYWxsZWU3IiwiX3JlcSRwYXJhbXMiLCJ1cGRhdGVkQ2FydEl0ZW1zIiwiX2NhbGxlZTckIiwiX2NvbnRleHQ3IiwibWFwIiwiJGluIiwiX3gxMSIsIl94MTIiLCJfcmVmNyIsIl9jYWxsZWU4IiwiX3JlcSRib2R5MyIsImV4aXN0aW5nVXNlciIsImhhc2hlZFBhc3N3b3JkIiwibmV3VXNlciIsIl9jYWxsZWU4JCIsIl9jb250ZXh0OCIsImhhc2giLCJpbnNlcnRPbmUiLCJfeDEzIiwiX3gxNCIsIl9yZWY4IiwiX2NhbGxlZTkiLCJfcmVxJGJvZHk0IiwiX2NhbGxlZTkkIiwiX2NvbnRleHQ5IiwiX3gxNSIsIl94MTYiLCJsaXN0ZW4iXSwic291cmNlUm9vdCI6IkQ6XFxsYXJhZ29uXFx3d3dcXE5vZGUgZXhlcmNpc2VzXFxyZXBvc1xcZnN2LWJhY2stZW5kXFxzcmNcXCIsInNvdXJjZXMiOlsic2VydmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgYm9keVBhcnNlciBmcm9tICdib2R5LXBhcnNlcic7XHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdCc7XHJcbmltcG9ydCBjb3JzIGZyb20gJ2NvcnMnO1xyXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcclxucmVxdWlyZSgnZG90ZW52JykuY29uZmlnKCk7XHJcblxyXG5cclxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xyXG5jb25zdCBjb3JzT3B0aW9ucyA9IHtcclxuICAgIG9yaWdpbjogJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MCcsXHJcbiAgICBtZXRob2RzOiAnR0VULEhFQUQsUFVULFBBVENILFBPU1QsREVMRVRFJyxcclxuICAgIGNyZWRlbnRpYWxzOiB0cnVlLFxyXG4gICAgb3B0aW9uc1N1Y2Nlc3NTdGF0dXM6IDIwNCxcclxufTtcclxuYXBwLnVzZShjb3JzKGNvcnNPcHRpb25zKSk7XHJcbmxldCBkYjtcclxuXHJcblxyXG5jb25zdCBjb25uZWN0aW9uU3RyaW5nID0gcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkkgfHwgJ21vbmdvZGI6Ly8xMjcuMC4wLjE6MjcwMTcnO1xyXG5jb25zb2xlLmxvZyhgQ29ubmVjdGluZyB0bzogJHtjb25uZWN0aW9uU3RyaW5nfWApO1xyXG5Nb25nb0NsaWVudC5jb25uZWN0KGNvbm5lY3Rpb25TdHJpbmcsIHsgdXNlTmV3VXJsUGFyc2VyOiB0cnVlLCB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWUgfSlcclxuICAgIC50aGVuKGNsaWVudCA9PiB7XHJcbiAgICAgICAgZGIgPSBjbGllbnQuZGIoJ3Z1ZS1kYicpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0ZWQgdG8gTW9uZ29EQicpO1xyXG5cclxuICAgICAgICAvLyBSdW4gdGhlIG1pZ3JhdGlvbiBzY3JpcHQgaGVyZVxyXG4gICAgICAgIGNvbnN0IHVzZXJzQ29sbGVjdGlvbiA9IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJyk7XHJcblxyXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bk1pZ3JhdGlvbigpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJzQ29sbGVjdGlvbi51cGRhdGVNYW55KHt9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNldDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkQ29uZmlybTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZpZWxkOiAnZGVmYXVsdCB2YWx1ZSdcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdEb2N1bWVudHMgdXBkYXRlZDonLCByZXN1bHQubW9kaWZpZWRDb3VudCk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBkb2N1bWVudHM6JywgZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNvbm5lY3QgdG8gTW9uZ29EQicsIGVycm9yKTtcclxuICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgICB9KTtcclxuXHJcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xyXG5cclxuYXBwLnVzZShleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vYXNzZXRzJykpKVxyXG5cclxuYXBwLnVzZSgocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGBSZXF1ZXN0IHJlY2VpdmVkOiAke3JlcS5tZXRob2R9ICR7cmVxLnVybH1gKTtcclxuICAgIG5leHQoKTtcclxufSk7XHJcblxyXG5cclxuZnVuY3Rpb24gYXV0aGVudGljYXRlVG9rZW4ocmVxLCByZXMsIG5leHQpIHtcclxuICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcignQXV0aG9yaXphdGlvbicpO1xyXG5cclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVW5hdXRob3JpemVkJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCAoZXJyLCB1c2VyKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnRm9yYmlkZGVuJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVxLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIG5leHQoKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5hcHAuZ2V0KCcvYXBpL3Byb3RlY3RlZCcsIGF1dGhlbnRpY2F0ZVRva2VuLCAocmVxLCByZXMpID0+IHtcclxuICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1Byb3RlY3RlZCByb3V0ZSBhY2Nlc3NlZCcgfSk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG5cclxuXHJcbmFwcC5nZXQoJy9hcGkvcHJvZHVjdHMnLCBhc3luYyhyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBwcm9kdWN0cyA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykuZmluZCh7fSkudG9BcnJheSgpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHByb2R1Y3RzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvZHVjdHM6JywgZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG5cclxuXHJcbmFwcC5wb3N0KCcvYXBpL3VzZXJEYXRhJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZmluZE9uZSh7IGVtYWlsIH0pO1xyXG5cclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaXNQYXNzd29yZFZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpO1xyXG5cclxuICAgIGlmICghaXNQYXNzd29yZFZhbGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ1VuYXV0aG9yaXplZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgIG5hbWU6IHVzZXIubmFtZSxcclxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcclxuICAgICAgICBpZDogdXNlci5pZCxcclxuICAgICAgICBjYXJ0SXRlbXM6IHVzZXIuY2FydEl0ZW1zXHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuYXBwLnBvc3QoJy9hcGkvY2FydC9hZGQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkLCBwcm9kdWN0SWQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmZpbmRPbmUoeyBlbWFpbCB9KTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbignQ291bGQgbm90IGZpbmQgdXNlciEnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpc1Bhc3N3b3JkVmFsaWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XHJcbiAgICBpZiAoIWlzUGFzc3dvcmRWYWxpZCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbignVW5hdXRob3JpemVkJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3Byb2R1Y3RzJykuZmluZE9uZSh7IGlkOiBwcm9kdWN0SWQgfSk7XHJcblxyXG4gICAgaWYgKCFwcm9kdWN0KSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKCdDb3VsZCBub3QgZmluZCBwcm9kdWN0IScpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiUHJvZHVjdCBhZGRlZCB0byBjYXJ0IHN1Y2Nlc3NmdWxseVwiKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiB0aGUgcHJvZHVjdCBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgY2FydFxyXG4gICAgY29uc3QgY2FydEl0ZW1JbmRleCA9IHVzZXIuY2FydEl0ZW1zLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ucHJvZHVjdElkID09PSBwcm9kdWN0SWQpO1xyXG5cclxuICAgIGlmIChjYXJ0SXRlbUluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIC8vIElmIHRoZSBwcm9kdWN0IGRvZXNuJ3QgZXhpc3QgaW4gdGhlIGNhcnQsIGFkZCBpdCBhcyBhIG5ldyBvYmplY3RcclxuICAgICAgICB1c2VyLmNhcnRJdGVtcy5wdXNoKHsgcHJvZHVjdElkLCBjb3VudDogMSB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gSWYgdGhlIHByb2R1Y3QgYWxyZWFkeSBleGlzdHMsIGluY3JlbWVudCBpdHMgY291bnRcclxuICAgICAgICB1c2VyLmNhcnRJdGVtc1tjYXJ0SXRlbUluZGV4XS5jb3VudCsrO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwZGF0ZSB0aGUgdXNlcidzIGNhcnRJdGVtc1xyXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS51cGRhdGVPbmUoeyBpZDogdXNlci5pZCB9LCB7XHJcbiAgICAgICAgJHNldDogeyBjYXJ0SXRlbXM6IHVzZXIuY2FydEl0ZW1zIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZmluZE9uZSh7IGlkOiB1c2VyLmlkIH0pO1xyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHVwZGF0ZWRVc2VyLmNhcnRJdGVtcyk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5hcHAuZ2V0KCcvYXBpL3VzZXJzLzp1c2VySWQvY2FydCcsIGFzeW5jKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS5wYXJhbXMudXNlcklkO1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmZpbmRPbmUoeyBpZDogdXNlcklkIH0pO1xyXG5cclxuICAgICAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKCdDb3VsZCBub3QgZmluZCB1c2VyIHdpdGggaWQ6ICcgKyB1c2VySWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdXNlckNhcnRJdGVtcyA9IHVzZXIuY2FydEl0ZW1zO1xyXG4gICAgICAgIGNvbnN0IHByb2R1Y3RzSW5DYXJ0ID0gW107XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgY2FydEl0ZW0gb2YgdXNlckNhcnRJdGVtcykge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9kdWN0SWQgPSBjYXJ0SXRlbS5wcm9kdWN0SWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdwcm9kdWN0cycpLmZpbmRPbmUoeyBpZDogcHJvZHVjdElkIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHByb2R1Y3QpIHtcclxuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgcHJvZHVjdCB3aXRoIGl0cyBjb3VudCB0byBwcm9kdWN0c0luQ2FydFxyXG4gICAgICAgICAgICAgICAgcHJvZHVjdHNJbkNhcnQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdCxcclxuICAgICAgICAgICAgICAgICAgICBjb3VudDogY2FydEl0ZW0uY291bnRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihwcm9kdWN0c0luQ2FydCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNhcnQgaXRlbXM6JywgZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuYXBwLmdldCgnL2FwaS9wcm9kdWN0cy86cHJvZHVjdElkLzp1c2VySWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGNvbnN0IHsgcHJvZHVjdElkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgdXNlcklkID0gcmVxLnBhcmFtcy51c2VySWQ7XHJcbiAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgZGIuY29sbGVjdGlvbigncHJvZHVjdHMnKS5maW5kT25lKHsgaWQ6IHByb2R1Y3RJZCB9KTtcclxuICAgIGlmIChwcm9kdWN0KSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24ocHJvZHVjdCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKCdDb3VsZCBub3QgZmluZCB0aGUgcHJvZHVjdCEnKTtcclxuICAgIH1cclxuXHJcbn0pO1xyXG5cclxuXHJcblxyXG5cclxuYXBwLmRlbGV0ZSgnL2FwaS91c2Vycy86dXNlcklkL2NhcnQvOnByb2R1Y3RJZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgY29uc3QgeyB1c2VySWQsIHByb2R1Y3RJZCB9ID0gcmVxLnBhcmFtcztcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgUmVtb3ZpbmcgcHJvZHVjdCB3aXRoIGlkICR7cHJvZHVjdElkfSBmcm9tIGNhcnQgb2YgdXNlciB3aXRoIGlkICR7dXNlcklkfWApO1xyXG5cclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCd1c2VycycpLmZpbmRPbmUoeyBpZDogdXNlcklkIH0pO1xyXG5cclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdVc2VyIG5vdCBmb3VuZC4nKTtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oJ0NvdWxkIG5vdCBmaW5kIHVzZXIhJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBkYXRlZENhcnRJdGVtcyA9IHVzZXIuY2FydEl0ZW1zLm1hcCgoY2FydEl0ZW0pID0+IHtcclxuICAgICAgICBpZiAoY2FydEl0ZW0uaWQgPT09IHByb2R1Y3RJZCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgRGVjcmVtZW50aW5nIGNvdW50IG9mIHByb2R1Y3QgJHtwcm9kdWN0SWR9IGluIGNhcnQuYCk7XHJcbiAgICAgICAgICAgIHJldHVybiB7IC4uLmNhcnRJdGVtLCBjb3VudDogY2FydEl0ZW0uY291bnQgLSAxIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYXJ0SXRlbTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdVcGRhdGVkIGNhcnQgaXRlbXM6JywgdXBkYXRlZENhcnRJdGVtcyk7XHJcblxyXG4gICAgYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS51cGRhdGVPbmUoeyBpZDogdXNlcklkIH0sIHtcclxuICAgICAgICAkc2V0OiB7IGNhcnRJdGVtczogdXBkYXRlZENhcnRJdGVtcyB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0NhcnQgdXBkYXRlZCBpbiB0aGUgZGF0YWJhc2UuJyk7XHJcblxyXG4gICAgY29uc3QgcHJvZHVjdHMgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdwcm9kdWN0cycpLmZpbmQoeyBpZDogeyAkaW46IHVzZXIuY2FydEl0ZW1zIH0gfSkudG9BcnJheSgpO1xyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24ocHJvZHVjdHMpO1xyXG59KTtcclxuXHJcblxyXG5cclxuXHJcblxyXG5hcHAucG9zdCgnL2FwaS9yZWdpc3RlcicsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGlkLCBuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIHBhc3N3b3JkQ29uZmlybSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIGlmICghbmFtZSB8fCAhZW1haWwgfHwgIXBhc3N3b3JkIHx8ICFwYXNzd29yZENvbmZpcm0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ1BsZWFzZSBmaWxsIGFsbCBmaWVsZHMnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBhc3N3b3JkICE9PSBwYXNzd29yZENvbmZpcm0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ1Bhc3N3b3JkcyBkbyBub3QgbWF0Y2gnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZmluZE9uZSh7IGVtYWlsIH0pO1xyXG4gICAgICAgIGlmIChleGlzdGluZ1VzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ0VtYWlsIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCcgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5ld1VzZXIgPSB7XHJcbiAgICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxyXG4gICAgICAgICAgICBjYXJ0SXRlbXM6IFtdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5pbnNlcnRPbmUobmV3VXNlcik7XHJcblxyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1VzZXIgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICAgICAgICB1c2VyOiB7IG5hbWUsIGVtYWlsIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlZ2lzdGVyaW5nIHVzZXI6JywgZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ1NlcnZlciBlcnJvcicgfSk7XHJcbiAgICB9XHJcblxyXG59KTtcclxuXHJcbmFwcC5wb3N0KCcvYXBpL2xvZ2luJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zdCB7IGVtYWlsLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XHJcbiAgICBjb25zb2xlLmxvZygnUmVjZWl2ZWQgbG9naW4gcmVxdWVzdCB3aXRoIGVtYWlsOicsIGVtYWlsKTtcclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbigndXNlcnMnKS5maW5kT25lKHsgZW1haWwgfSk7XHJcbiAgICBjb25zb2xlLmxvZygnRm91bmQgdXNlcjonLCB1c2VyKTtcclxuXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaXNQYXNzd29yZFZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpO1xyXG4gICAgY29uc29sZS5sb2coJ1Bhc3N3b3JkIHZhbGlkYXRpb24gcmVzdWx0OicsIGlzUGFzc3dvcmRWYWxpZCk7XHJcblxyXG4gICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBlbWFpbCBvciBwYXNzd29yZCcgfSk7XHJcbiAgICB9XHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgICAgbWVzc2FnZTogJ0xvZ2luIHN1Y2Nlc3NmdWwnLFxyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxyXG4gICAgICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcclxuICAgICAgICAgICAgY2FydEl0ZW1zOiB1c2VyLmNhcnRJdGVtcyxcclxuICAgICAgICAgICAgaWQ6IHVzZXIuaWRcclxuICAgICAgICB9LFxyXG5cclxuICAgIH0pO1xyXG59KTtcclxuXHJcblxyXG5cclxuXHJcbmFwcC5saXN0ZW4oODAwNiwgKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ1NlcnZlciBpcyBsaXN0ZW5pbmcgb24gcG9ydCA4MDA2Jyk7XHJcbn0pOyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsV0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsUUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsS0FBQSxHQUFBSixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssS0FBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQXdCLFNBQUFNLFFBQUFDLE1BQUEsRUFBQUMsY0FBQSxRQUFBQyxJQUFBLEdBQUFDLE1BQUEsQ0FBQUQsSUFBQSxDQUFBRixNQUFBLE9BQUFHLE1BQUEsQ0FBQUMscUJBQUEsUUFBQUMsT0FBQSxHQUFBRixNQUFBLENBQUFDLHFCQUFBLENBQUFKLE1BQUEsR0FBQUMsY0FBQSxLQUFBSSxPQUFBLEdBQUFBLE9BQUEsQ0FBQUMsTUFBQSxXQUFBQyxHQUFBLFdBQUFKLE1BQUEsQ0FBQUssd0JBQUEsQ0FBQVIsTUFBQSxFQUFBTyxHQUFBLEVBQUFFLFVBQUEsT0FBQVAsSUFBQSxDQUFBUSxJQUFBLENBQUFDLEtBQUEsQ0FBQVQsSUFBQSxFQUFBRyxPQUFBLFlBQUFILElBQUE7QUFBQSxTQUFBVSxjQUFBQyxNQUFBLGFBQUFDLENBQUEsTUFBQUEsQ0FBQSxHQUFBQyxTQUFBLENBQUFDLE1BQUEsRUFBQUYsQ0FBQSxVQUFBRyxNQUFBLFdBQUFGLFNBQUEsQ0FBQUQsQ0FBQSxJQUFBQyxTQUFBLENBQUFELENBQUEsUUFBQUEsQ0FBQSxPQUFBZixPQUFBLENBQUFJLE1B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","map":{"version":3,"names":["_express","_interopRequireDefault","require","_bodyParser","_mongodb","_path","_bcrypt","_cors","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","minLen","_arrayLikeToArray","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","jwt","config","app","express","corsOptions","origin","methods","credentials","optionsSuccessStatus","use","cors","db","connectionString","process","env","MONGODB_URI","console","log","concat","MongoClient","connect","useNewUrlParser","useUnifiedTopology","then","client","usersCollection","collection","runMigration","_runMigration","_asyncToGenerator2","_regenerator","mark","_callee","result","wrap","_callee$","_context","prev","updateMany","$set","email","password","passwordConfirm","newField","sent","modifiedCount","t0","error","stop","exit","bodyParser","json","path","join","__dirname","req","res","method","url","authenticateToken","token","header","status","message","verify","JWT_SECRET","user","get","_ref","_callee2","products","_callee2$","_context2","find","toArray","_x","_x2","post","_ref2","_callee3","_req$body","isPasswordValid","_callee3$","_context3","body","findOne","abrupt","bcrypt","compare","id","cartItems","_x3","_x4","_ref3","_callee4","_req$body2","productId","product","cartItemIndex","updatedUser","_callee4$","_context4","findIndex","item","count","updateOne","_x5","_x6","_ref4","_callee5","userId","userCartItems","productsInCart","_iterator","_step","cartItem","_callee5$","_context5","params","finish","t1","_x7","_x8","_ref5","_callee6","_callee6$","_context6","_x9","_x10","_ref6","_callee7","_req$params","updatedCartItems","_callee7$","_context7","map","$in","_x11","_x12","_ref7","_callee8","_req$body3","existingUser","hashedPassword","newUser","_callee8$","_context8","hash","insertOne","_x13","_x14","_ref8","_callee9","_req$body4","_callee9$","_context9","_x15","_x16","listen"],"sourceRoot":"D:\\laragon\\www\\Node exercises\\repos\\fsv-back-end\\src\\","sources":["server.js"],"sourcesContent":["import express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport { MongoClient } from 'mongodb';\r\nimport path from 'path';\r\nimport bcrypt from 'bcrypt';\r\nimport cors from 'cors';\r\nconst jwt = require('jsonwebtoken');\r\nrequire('dotenv').config();\r\n\r\n\r\nconst app = express();\r\nconst corsOptions = {\r\n    origin: 'http://localhost:8080',\r\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\r\n    credentials: true,\r\n    optionsSuccessStatus: 204,\r\n};\r\napp.use(cors(corsOptions));\r\nlet db;\r\n\r\n\r\nconst connectionString = process.env.MONGODB_URI || 'mongodb://127.0.0.1:27017';\r\nconsole.log(`Connecting to: ${connectionString}`);\r\nMongoClient.connect(connectionString, { useNewUrlParser: true, useUnifiedTopology: true })\r\n    .then(client => {\r\n        db = client.db('vue-db');\r\n        console.log('Connected to MongoDB');\r\n\r\n        // Run the migration script here\r\n        const usersCollection = db.collection('users');\r\n\r\n        async function runMigration() {\r\n            try {\r\n                const result = await usersCollection.updateMany({}, {\r\n                    $set: {\r\n                        name: '',\r\n                        email: '',\r\n                        password: '',\r\n                        passwordConfirm: '',\r\n                        newField: 'default value'\r\n                    }\r\n                });\r\n                console.log('Documents updated:', result.modifiedCount);\r\n            } catch (error) {\r\n                console.error('Error updating documents:', error);\r\n            }\r\n        }\r\n\r\n\r\n\r\n    })\r\n    .catch(error => {\r\n        console.error('Failed to connect to MongoDB', error);\r\n        process.exit(1);\r\n    });\r\n\r\napp.use(bodyParser.json());\r\n\r\napp.use(express.static(path.join(__dirname, '../assets')))\r\n\r\napp.use((req, res, next) => {\r\n    console.log(`Request received: ${req.method} ${req.url}`);\r\n    next();\r\n});\r\n\r\n\r\nfunction authenticateToken(req, res, next) {\r\n    const token = req.header('Authorization');\r\n\r\n    if (!token) {\r\n        return res.status(401).json({ message: 'Unauthorized' });\r\n    }\r\n\r\n    jwt.verify(token, process.env.JWT_SECRET, (err, user) => {\r\n        if (err) {\r\n            return res.status(403).json({ message: 'Forbidden' });\r\n        }\r\n        req.user = user;\r\n        next();\r\n    });\r\n}\r\n\r\n\r\n\r\n\r\napp.get('/api/protected', authenticateToken, (req, res) => {\r\n    res.json({ message: 'Protected route accessed' });\r\n});\r\n\r\n\r\n\r\n\r\n\r\napp.get('/api/products', async(req, res) => {\r\n    try {\r\n        const products = await db.collection('products').find({}).toArray();\r\n        res.status(200).json(products);\r\n    } catch (error) {\r\n        console.error('Error fetching products:', error);\r\n        res.status(500).json({ error: 'Internal Server Error' });\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\napp.post('/api/userData', async (req, res) => {\r\n    const { email, password } = req.body;\r\n\r\n    const user = await db.collection('users').findOne({ email });\r\n\r\n    if (!user) {\r\n        return res.status(404).json({ message: 'User not found' });\r\n    }\r\n\r\n    const isPasswordValid = await bcrypt.compare(password, user.password);\r\n\r\n    if (!isPasswordValid) {\r\n        return res.status(401).json({ message: 'Unauthorized' });\r\n    }\r\n\r\n    res.status(200).json({\r\n        name: user.name,\r\n        email: user.email,\r\n        id: user.id,\r\n        cartItems: user.cartItems\r\n    });\r\n});\r\n\r\n\r\n\r\n\r\n\r\napp.post('/api/cart/add', async (req, res) => {\r\n    const { email, password, productId } = req.body;\r\n\r\n    const user = await db.collection('users').findOne({ email });\r\n    if (!user) {\r\n        return res.status(404).json('Could not find user!');\r\n    }\r\n\r\n    const isPasswordValid = await bcrypt.compare(password, user.password);\r\n    if (!isPasswordValid) {\r\n        return res.status(401).json('Unauthorized');\r\n    }\r\n\r\n    const product = await db.collection('products').findOne({ id: productId });\r\n\r\n    if (!product) {\r\n        return res.status(404).json('Could not find product!');\r\n    }\r\n\r\n    console.log(\"Product added to cart successfully\");\r\n\r\n    // Check if the product already exists in the cart\r\n    const cartItemIndex = user.cartItems.findIndex(item => item.productId === productId);\r\n\r\n    if (cartItemIndex === -1) {\r\n        // If the product doesn't exist in the cart, add it as a new object\r\n        user.cartItems.push({ productId, count: 1 });\r\n    } else {\r\n        // If the product already exists, increment its count\r\n        user.cartItems[cartItemIndex].count++;\r\n    }\r\n\r\n    // Update the user's cartItems\r\n    await db.collection('users').updateOne({ id: user.id }, {\r\n        $set: { cartItems: user.cartItems },\r\n    });\r\n\r\n    const updatedUser = await db.collection('users').findOne({ id: user.id });\r\n\r\n    res.status(200).json(updatedUser.cartItems);\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\napp.get('/api/users/:userId/cart', async(req, res) => {\r\n    try {\r\n        const userId = req.params.userId;\r\n        const user = await db.collection('users').findOne({ id: userId });\r\n\r\n        if (!user) {\r\n            return res.status(404).json('Could not find user with id: ' + userId);\r\n        }\r\n\r\n        const userCartItems = user.cartItems;\r\n        const productsInCart = [];\r\n\r\n        for (const cartItem of userCartItems) {\r\n            const productId = cartItem.productId;\r\n            const product = await db.collection('products').findOne({ id: productId });\r\n\r\n            if (product) {\r\n                // Add the product with its count to productsInCart\r\n                productsInCart.push({\r\n                    product,\r\n                    count: cartItem.count\r\n                });\r\n            }\r\n        }\r\n\r\n        res.status(200).json(productsInCart);\r\n    } catch (error) {\r\n        console.error('Error fetching cart items:', error);\r\n        res.status(500).json({ error: 'Internal Server Error' });\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\napp.get('/api/products/:productId/:userId', async (req, res) => {\r\n    const { productId } = req.params;\r\n    const userId = req.params.userId;\r\n    const product = await db.collection('products').findOne({ id: productId });\r\n    if (product) {\r\n        res.status(200).json(product);\r\n    } else {\r\n        res.status(404).json('Could not find the product!');\r\n    }\r\n\r\n});\r\n\r\n\r\n\r\n\r\napp.delete('/api/users/:userId/cart/:productId', async (req, res) => {\r\n    const { userId, productId } = req.params;\r\n\r\n    console.log(`Removing product with id ${productId} from cart of user with id ${userId}`);\r\n\r\n    const user = await db.collection('users').findOne({ id: userId });\r\n\r\n    if (!user) {\r\n        console.log('User not found.');\r\n        return res.status(404).json('Could not find user!');\r\n    }\r\n\r\n    const updatedCartItems = user.cartItems.map((cartItem) => {\r\n        if (cartItem.id === productId) {\r\n            console.log(`Decrementing count of product ${productId} in cart.`);\r\n            return { ...cartItem, count: cartItem.count - 1 };\r\n        }\r\n        return cartItem;\r\n    });\r\n\r\n    console.log('Updated cart items:', updatedCartItems);\r\n\r\n    await db.collection('users').updateOne({ id: userId }, {\r\n        $set: { cartItems: updatedCartItems },\r\n    });\r\n\r\n    console.log('Cart updated in the database.');\r\n\r\n    const products = await db.collection('products').find({ id: { $in: user.cartItems } }).toArray();\r\n    res.status(200).json(products);\r\n});\r\n\r\n\r\n\r\n\r\n\r\napp.post('/api/register', async (req, res) => {\r\n    try {\r\n        const { id, name, email, password, passwordConfirm } = req.body;\r\n\r\n        if (!name || !email || !password || !passwordConfirm) {\r\n            return res.status(400).json({ message: 'Please fill all fields' });\r\n        }\r\n\r\n        if (password !== passwordConfirm) {\r\n            return res.status(400).json({ message: 'Passwords do not match' });\r\n        }\r\n\r\n\r\n        const existingUser = await db.collection('users').findOne({ email });\r\n        if (existingUser) {\r\n            return res.status(400).json({ message: 'Email is already registered' });\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n        const newUser = {\r\n            id,\r\n            name,\r\n            email,\r\n            password: hashedPassword,\r\n            cartItems: []\r\n        };\r\n\r\n        await db.collection('users').insertOne(newUser);\r\n\r\n        res.status(201).json({\r\n            message: 'User registered successfully',\r\n            user: { name, email }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Error registering user:', error);\r\n        res.status(500).json({ message: 'Server error' });\r\n    }\r\n\r\n});\r\n\r\napp.post('/api/login', async (req, res) => {\r\n    const { email, password } = req.body;\r\n    console.log('Received login request with email:', email);\r\n\r\n    const user = await db.collection('users').findOne({ email });\r\n    console.log('Found user:', user);\r\n\r\n    if (!user) {\r\n        return res.status(400).json({ message: 'Invalid email or password' });\r\n    }\r\n\r\n    const isPasswordValid = await bcrypt.compare(password, user.password);\r\n    console.log('Password validation result:', isPasswordValid);\r\n\r\n    if (!isPasswordValid) {\r\n        return res.status(401).json({ message: 'Invalid email or password' });\r\n    }\r\n    res.status(200).json({\r\n        message: 'Login successful',\r\n        user: {\r\n            name: user.name,\r\n            email: user.email,\r\n            cartItems: user.cartItems,\r\n            id: user.id\r\n        },\r\n\r\n    });\r\n});\r\n\r\n\r\n\r\n\r\napp.listen(8006, () => {\r\n    console.log('Server is listening on port 8006');\r\n});"],"mappings":"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"}},"mtime":1697713858415},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"filename\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\\\\controllers\\\\auth.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\laragon\\\\www\\\\Node exercises\\\\repos\\\\fsv-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:development":{"value":{"code":"const bcrypt = require('bcrypt');\nconst jwt = require('jsonwebtoken');\nconst {\n  MongoClient\n} = require(\"mongodb\");\nconst client = new MongoClient(process.env.MONGODB_URI, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\n\n// Connect to the MongoDB database\n(async () => {\n  try {\n    console.log(\"Connecting to:\", process.env.MONGODB_URI);\n    await client.connect();\n    console.log(\"Connected to MongoDB\");\n  } catch (err) {\n    console.error(\"Error connecting to the database:\", err);\n  }\n})();\n\n// Make sure to close the connection when the app exits\nprocess.on(\"SIGINT\", () => {\n  client.close().then(() => {\n    console.log(\"MongoDB connection closed.\");\n    process.exit(0);\n  });\n});\nexports.login = async (req, res) => {\n  try {\n    const {\n      email,\n      password\n    } = req.body;\n    if (!email || !password) {\n      return res.status(400).render(\"login\", {\n        message: \"Please provide an email and password\"\n      });\n    }\n    const usersCollection = client.db(\"vue-db\").collection(\"users\");\n    const user = await usersCollection.findOne({\n      email\n    });\n    if (!user || !(await bcrypt.compare(password, user.password))) {\n      res.status(401).render(\"login\", {\n        message: \"Email or password is incorrect\"\n      });\n    } else {\n      const id = user._id;\n      const token = jwt.sign({\n        id\n      }, process.env.JWT_SECRET, {\n        expiresIn: process.env.JWT_EXPIRES_IN\n      });\n      console.log(\"The token is: \" + token);\n      const cookieOptions = {\n        expires: new Date(Date.now() + process.env.JWT_COOKIES_EXPIRES * 24 * 60 * 60 * 1000),\n        httpOnly: true\n      };\n      res.cookie(\"jwt\", token, cookieOptions);\n      res.status(200).redirect(\"/\");\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\nexports.register = async (req, res) => {\n  console.log(req.body);\n  const {\n    name,\n    email,\n    password,\n    passwordConfirm\n  } = req.body;\n  const usersCollection = client.db(\"vue-db\").collection(\"users\");\n  try {\n    const existingUser = await usersCollection.findOne({\n      email\n    });\n    if (existingUser) {\n      return res.render(\"register\", {\n        message: \"That email is already in use.\"\n      });\n    } else if (password !== passwordConfirm) {\n      return res.render(\"register\", {\n        message: \"Passwords do not match\"\n      });\n    }\n    const hashedPassword = await bcrypt.hash(password, 8);\n    console.log(hashedPassword);\n    const newUser = {\n      name: name,\n      email: email,\n      password: hashedPassword\n    };\n    await usersCollection.insertOne(newUser);\n    return res.render(\"register\", {\n      message: \"User registered\"\n    });\n  } catch (error) {\n    console.log(error);\n    res.status(500).send(\"Server Error\");\n  }\n};\nexports.logout = async (req, res) => {\n  res.clearCookie(\"jwt\"); // Clear the JWT cookie from the user's browser\n  res.status(200).redirect(\"/login\"); // Redirect the user to the login page after logout\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJiY3J5cHQiLCJyZXF1aXJlIiwiand0IiwiTW9uZ29DbGllbnQiLCJjbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VVbmlmaWVkVG9wb2xvZ3kiLCJjb25zb2xlIiwibG9nIiwiY29ubmVjdCIsImVyciIsImVycm9yIiwib24iLCJjbG9zZSIsInRoZW4iLCJleGl0IiwiZXhwb3J0cyIsImxvZ2luIiwicmVxIiwicmVzIiwiZW1haWwiLCJwYXNzd29yZCIsImJvZHkiLCJzdGF0dXMiLCJyZW5kZXIiLCJtZXNzYWdlIiwidXNlcnNDb2xsZWN0aW9uIiwiZGIiLCJjb2xsZWN0aW9uIiwidXNlciIsImZpbmRPbmUiLCJjb21wYXJlIiwiaWQiLCJfaWQiLCJ0b2tlbiIsInNpZ24iLCJKV1RfU0VDUkVUIiwiZXhwaXJlc0luIiwiSldUX0VYUElSRVNfSU4iLCJjb29raWVPcHRpb25zIiwiZXhwaXJlcyIsIkRhdGUiLCJub3ciLCJKV1RfQ09PS0lFU19FWFBJUkVTIiwiaHR0cE9ubHkiLCJjb29raWUiLCJyZWRpcmVjdCIsInJlZ2lzdGVyIiwibmFtZSIsInBhc3N3b3JkQ29uZmlybSIsImV4aXN0aW5nVXNlciIsImhhc2hlZFBhc3N3b3JkIiwiaGFzaCIsIm5ld1VzZXIiLCJpbnNlcnRPbmUiLCJzZW5kIiwibG9nb3V0IiwiY2xlYXJDb29raWUiXSwic291cmNlUm9vdCI6IkQ6XFxsYXJhZ29uXFx3d3dcXE5vZGUgZXhlcmNpc2VzXFxyZXBvc1xcZnN2LWJhY2stZW5kXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJhdXRoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJjcnlwdCA9IHJlcXVpcmUgKCdiY3J5cHQnKTtcclxuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcblxyXG5jb25zdCB7IE1vbmdvQ2xpZW50IH0gPSByZXF1aXJlKFwibW9uZ29kYlwiKTtcclxuY29uc3QgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJLCB7XHJcbiAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXHJcbiAgICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWUsXHJcbn0pO1xyXG5cclxuLy8gQ29ubmVjdCB0byB0aGUgTW9uZ29EQiBkYXRhYmFzZVxyXG4oYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbm5lY3RpbmcgdG86XCIsIHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJKTtcclxuICAgICAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ29ubmVjdGVkIHRvIE1vbmdvREJcIik7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY29ubmVjdGluZyB0byB0aGUgZGF0YWJhc2U6XCIsIGVycik7XHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG5cclxuLy8gTWFrZSBzdXJlIHRvIGNsb3NlIHRoZSBjb25uZWN0aW9uIHdoZW4gdGhlIGFwcCBleGl0c1xyXG5wcm9jZXNzLm9uKFwiU0lHSU5UXCIsICgpID0+IHtcclxuICAgIGNsaWVudC5jbG9zZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiTW9uZ29EQiBjb25uZWN0aW9uIGNsb3NlZC5cIik7XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KDApO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5leHBvcnRzLmxvZ2luID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZW1haWwsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcclxuICAgICAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnJlbmRlcihcImxvZ2luXCIsIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiUGxlYXNlIHByb3ZpZGUgYW4gZW1haWwgYW5kIHBhc3N3b3JkXCIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdXNlcnNDb2xsZWN0aW9uID0gY2xpZW50LmRiKFwidnVlLWRiXCIpLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdXNlcnNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbCB9KTtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyIHx8ICEoYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpKSkge1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwMSkucmVuZGVyKFwibG9naW5cIiwge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJFbWFpbCBvciBwYXNzd29yZCBpcyBpbmNvcnJlY3RcIixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaWQgPSB1c2VyLl9pZDtcclxuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih7IGlkIH0sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHtcclxuICAgICAgICAgICAgICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSB0b2tlbiBpczogXCIgKyB0b2tlbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvb2tpZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBleHBpcmVzOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgcHJvY2Vzcy5lbnYuSldUX0NPT0tJRVNfRVhQSVJFUyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxyXG4gICAgICAgICAgICAgICAgaHR0cE9ubHk6IHRydWUsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlcy5jb29raWUoXCJqd3RcIiwgdG9rZW4sIGNvb2tpZU9wdGlvbnMpO1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkucmVkaXJlY3QoXCIvXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgfVxyXG59O1xyXG5leHBvcnRzLnJlZ2lzdGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhyZXEuYm9keSk7XHJcblxyXG4gICAgY29uc3QgeyBuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIHBhc3N3b3JkQ29uZmlybSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc3QgdXNlcnNDb2xsZWN0aW9uID0gY2xpZW50LmRiKFwidnVlLWRiXCIpLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHVzZXJzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWwgfSk7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnJlbmRlcihcInJlZ2lzdGVyXCIsIHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiVGhhdCBlbWFpbCBpcyBhbHJlYWR5IGluIHVzZS5cIixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwYXNzd29yZCAhPT0gcGFzc3dvcmRDb25maXJtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMucmVuZGVyKFwicmVnaXN0ZXJcIiwge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJQYXNzd29yZHMgZG8gbm90IG1hdGNoXCIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgOCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coaGFzaGVkUGFzc3dvcmQpO1xyXG5cclxuICAgICAgICBjb25zdCBuZXdVc2VyID0ge1xyXG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhd2FpdCB1c2Vyc0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld1VzZXIpO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzLnJlbmRlcihcInJlZ2lzdGVyXCIsIHtcclxuICAgICAgICAgICAgbWVzc2FnZTogXCJVc2VyIHJlZ2lzdGVyZWRcIixcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiU2VydmVyIEVycm9yXCIpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZXhwb3J0cy5sb2dvdXQgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgICAgICByZXMuY2xlYXJDb29raWUoXCJqd3RcIik7IC8vIENsZWFyIHRoZSBKV1QgY29va2llIGZyb20gdGhlIHVzZXIncyBicm93c2VyXHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLnJlZGlyZWN0KFwiL2xvZ2luXCIpOyAvLyBSZWRpcmVjdCB0aGUgdXNlciB0byB0aGUgbG9naW4gcGFnZSBhZnRlciBsb2dvdXRcclxufTtcclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUUsUUFBUSxDQUFDO0FBQ2pDLE1BQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUVuQyxNQUFNO0VBQUVFO0FBQVksQ0FBQyxH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","map":{"version":3,"names":["bcrypt","require","jwt","MongoClient","client","process","env","MONGODB_URI","useNewUrlParser","useUnifiedTopology","console","log","connect","err","error","on","close","then","exit","exports","login","req","res","email","password","body","status","render","message","usersCollection","db","collection","user","findOne","compare","id","_id","token","sign","JWT_SECRET","expiresIn","JWT_EXPIRES_IN","cookieOptions","expires","Date","now","JWT_COOKIES_EXPIRES","httpOnly","cookie","redirect","register","name","passwordConfirm","existingUser","hashedPassword","hash","newUser","insertOne","send","logout","clearCookie"],"sourceRoot":"D:\\laragon\\www\\Node exercises\\repos\\fsv-back-end\\controllers\\","sources":["auth.js"],"sourcesContent":["const bcrypt = require ('bcrypt');\r\nconst jwt = require('jsonwebtoken');\r\n\r\nconst { MongoClient } = require(\"mongodb\");\r\nconst client = new MongoClient(process.env.MONGODB_URI, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true,\r\n});\r\n\r\n// Connect to the MongoDB database\r\n(async () => {\r\n    try {\r\n        console.log(\"Connecting to:\", process.env.MONGODB_URI);\r\n        await client.connect();\r\n        console.log(\"Connected to MongoDB\");\r\n    } catch (err) {\r\n        console.error(\"Error connecting to the database:\", err);\r\n    }\r\n})();\r\n\r\n\r\n// Make sure to close the connection when the app exits\r\nprocess.on(\"SIGINT\", () => {\r\n    client.close().then(() => {\r\n        console.log(\"MongoDB connection closed.\");\r\n        process.exit(0);\r\n    });\r\n});\r\nexports.login = async (req, res) => {\r\n    try {\r\n        const { email, password } = req.body;\r\n        if (!email || !password) {\r\n            return res.status(400).render(\"login\", {\r\n                message: \"Please provide an email and password\",\r\n            });\r\n        }\r\n\r\n        const usersCollection = client.db(\"vue-db\").collection(\"users\");\r\n        const user = await usersCollection.findOne({ email });\r\n\r\n        if (!user || !(await bcrypt.compare(password, user.password))) {\r\n            res.status(401).render(\"login\", {\r\n                message: \"Email or password is incorrect\",\r\n            });\r\n        } else {\r\n            const id = user._id;\r\n            const token = jwt.sign({ id }, process.env.JWT_SECRET, {\r\n                expiresIn: process.env.JWT_EXPIRES_IN,\r\n            });\r\n            console.log(\"The token is: \" + token);\r\n            const cookieOptions = {\r\n                expires: new Date(Date.now() + process.env.JWT_COOKIES_EXPIRES * 24 * 60 * 60 * 1000),\r\n                httpOnly: true,\r\n            };\r\n            res.cookie(\"jwt\", token, cookieOptions);\r\n            res.status(200).redirect(\"/\");\r\n        }\r\n    } catch (error) {\r\n        console.log(error);\r\n    }\r\n};\r\nexports.register = async (req, res) => {\r\n    console.log(req.body);\r\n\r\n    const { name, email, password, passwordConfirm } = req.body;\r\n\r\n    const usersCollection = client.db(\"vue-db\").collection(\"users\");\r\n\r\n    try {\r\n        const existingUser = await usersCollection.findOne({ email });\r\n        if (existingUser) {\r\n            return res.render(\"register\", {\r\n                message: \"That email is already in use.\",\r\n            });\r\n        } else if (password !== passwordConfirm) {\r\n            return res.render(\"register\", {\r\n                message: \"Passwords do not match\",\r\n            });\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 8);\r\n        console.log(hashedPassword);\r\n\r\n        const newUser = {\r\n            name: name,\r\n            email: email,\r\n            password: hashedPassword,\r\n        };\r\n\r\n        await usersCollection.insertOne(newUser);\r\n\r\n        return res.render(\"register\", {\r\n            message: \"User registered\",\r\n        });\r\n    } catch (error) {\r\n        console.log(error);\r\n        res.status(500).send(\"Server Error\");\r\n    }\r\n};\r\n\r\nexports.logout = async (req, res) => {\r\n        res.clearCookie(\"jwt\"); // Clear the JWT cookie from the user's browser\r\n        res.status(200).redirect(\"/login\"); // Redirect the user to the login page after logout\r\n};\r\n\r\n"],"mappings":"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"}},"mtime":1691738442115}}